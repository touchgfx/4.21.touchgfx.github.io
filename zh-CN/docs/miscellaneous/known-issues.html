<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-miscellaneous/known-issues">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.21/zh-CN/opensearch.xml">
<script src="/4.21/zh-CN/js/one-trust.js"></script>
<script src="/4.21/js/fix-location.js"></script><title data-rh="true">已知问题 | TouchGFX Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://support.touchgfx.com/4.21/zh-CN/img/meta-image.png"><meta data-rh="true" name="twitter:image" content="https://support.touchgfx.com/4.21/zh-CN/img/meta-image.png"><meta data-rh="true" property="og:url" content="https://support.touchgfx.com/4.21/zh-CN/docs/miscellaneous/known-issues"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="已知问题 | TouchGFX Documentation"><link data-rh="true" rel="icon" href="/4.21/zh-CN/img/favicon.png"><link data-rh="true" rel="canonical" href="https://support.touchgfx.com/4.21/zh-CN/docs/miscellaneous/known-issues"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/miscellaneous/known-issues" hreflang="en"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ko/docs/miscellaneous/known-issues" hreflang="ko"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ja/docs/miscellaneous/known-issues" hreflang="ja"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-CN/docs/miscellaneous/known-issues" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-TW/docs/miscellaneous/known-issues" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/miscellaneous/known-issues" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.21/zh-CN/assets/css/styles.a3789d89.css">
<link rel="preload" href="/4.21/zh-CN/assets/js/runtime~main.1202490c.js" as="script">
<link rel="preload" href="/4.21/zh-CN/assets/js/main.8eee2a9c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><div role="region"><a href="#" class="skipToContent_fXgn">跳转到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.21/zh-CN/docs/introduction/welcome"><div class="navbar__logo"><img src="/4.21/zh-CN/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--light_HNdA"><img src="/4.21/zh-CN/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">简体中文</a><ul class="dropdown__menu"><li><a href="/4.21/docs/miscellaneous/known-issues" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/4.21/ko/docs/miscellaneous/known-issues" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li><li><a href="/4.21/ja/docs/miscellaneous/known-issues" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/4.21/zh-CN/docs/miscellaneous/known-issues" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">简体中文</a></li><li><a href="/4.21/zh-TW/docs/miscellaneous/known-issues" target="_self" rel="noopener noreferrer" class="dropdown__link">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/4.21/zh-CN/docs/introduction/welcome">4.21</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.21/zh-CN/docs/miscellaneous/known-issues">4.21</a></li><li><a href="https://support.touchgfx.com/4.20" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.20<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.19" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.19<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.18" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.18<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.17" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.17<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.16" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.16<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">社区</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_ZlJk"><div class="searchBox_Gz_y"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/zh-CN/docs/category/introduction">介绍</a><button aria-label="Toggle the collapsible sidebar category &#x27;介绍&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/zh-CN/docs/category/basic-concepts">基本概念</a><button aria-label="Toggle the collapsible sidebar category &#x27;基本概念&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/zh-CN/docs/development/development-introduction">开发</a><button aria-label="Toggle the collapsible sidebar category &#x27;开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/4.21/zh-CN/docs/category/miscellaneous-1">其他情况</a><button aria-label="Toggle the collapsible sidebar category &#x27;其他情况&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/zh-CN/docs/miscellaneous/updating-to-a-new-touchgfx-version">更新至新的TouchGFX版本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/zh-CN/docs/miscellaneous/getting-help">获取帮助</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.21/zh-CN/docs/miscellaneous/known-issues">已知问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/zh-CN/docs/miscellaneous/changelog">修订日志</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/zh-CN/docs/miscellaneous/3rd-party-components-in-touchgfx">TouchGFX中的第三方组件</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/zh-CN/docs/category/tutorials">指导</a><button aria-label="Toggle the collapsible sidebar category &#x27;指导&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.21/zh-CN/docs/api/classes/classtouchgfx_1_1_abstract_button">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/zh-CN/docs/category/resources">资源</a><button aria-label="Toggle the collapsible sidebar category &#x27;资源&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/4.21/zh-CN/docs/category/miscellaneous-1"><span itemprop="name">其他情况</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">已知问题</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">在当前页面</button></div><div class="theme-doc-markdown markdown"><header><h1>已知问题</h1></header><p>本文列出了所有TouchGFX版本中已知存在的问题以及潜在的权宜措施。 此外，如果您需要执行任何特定的升级步骤才能将TouchGFX升级至特定版本，文中将会提到。 请注意，如果当前版本与最新版本之间隔了几个版本，您需要执行所有版本的升级步骤，直至升级到最新版本。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-4-21-0">TouchGFX 4.21.0<a class="hash-link" href="#touchgfx-4-21-0" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="widetextaction">WideTextAction<a class="hash-link" href="#widetextaction" title="直接链接到标题">​</a></h3><p>The definition of the enumeration WideTextAction in Types.hpp has been changed as it was misleading. If you are using WIDE_TEXT_WORDWRAP in TouchGFX 4.20 or earlier and expect to see an ellipsis (<!-- -->…<!-- -->), you must use WIDE_TEXT_WORDWRAP_ELLIPSIS in TouchGFX 4.21. See also <a href="/4.21/zh-CN/docs/development/ui-development/touchgfx-engine-features/texts-and-fonts#automatic-wrapping-of-long-text-lines">Text and Fonts</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="compiling-stm32u599-projects-with-iar">Compiling STM32U599 projects with IAR<a class="hash-link" href="#compiling-stm32u599-projects-with-iar" title="直接链接到标题">​</a></h3><p>When upgrading a TouchGFX project from version 4.20 or older project to TouchGFX 4.21 you will see a linking error in IAR.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error[Li006]: duplicate definitions for &quot;HAL_CPU2D_CommandListCpltCallback&quot;; in &quot;...\Obj\nema_hal.o&quot;, and &quot;...\Obj\nema_hal_threadx.o&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error[Li006]: duplicate definitions for &quot;nema_buffer_create&quot;; in &quot;...\Obj\nema_hal.o&quot;, and &quot;...\Obj\nema_hal_threadx.o&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The reason for this error is that the file TouchGFX/Target/generated/nema_hal_threadx.c has been renamed to TouchGFX/Target/generated/nema_hal.c. It was a bug to include the operating system in the filename. CubeMX creates a file with the new name while leaving the old file in place. Both files are compiled by IAR. The resolution is to remove the file TouchGFX/Target/generated/nema_hal_threadx.c.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="svg-drawing-on-stm32-with-neochrom">SVG drawing on STM32 with NeoChrom<a class="hash-link" href="#svg-drawing-on-stm32-with-neochrom" title="直接链接到标题">​</a></h3><p>SVG shapes with large coordinates may render incorrectly on targets with NeoChrom. This is due to a limitation in the NeoChrom library. The problem can arise either due to scaling up or due to large coordinates in the SVG itself.</p><p>The resolution is to insert a call to <em>nema_vg_handle_large_coords()</em>. A good place is in the function <em>touchgfx_components_init()</em> in <code>TouchGFX/target/generated/TouchGFXConfiguration.cpp</code>:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">touchgfx_components_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">nema_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">nema_vg_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">480</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">nema_vg_handle_large_coords</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: This solution comes with a slight performance decrease.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-4-20-0">TouchGFX 4.20.0<a class="hash-link" href="#touchgfx-4-20-0" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="painter-interface-changed">Painter interface changed<a class="hash-link" href="#painter-interface-changed" title="直接链接到标题">​</a></h3><p>The method AbstractPainter::render() has been replaced by <a href="/4.21/zh-CN/docs/api/classes/classtouchgfx_1_1_abstract_painter#function-paint">AbstractPainter::paint</a> for performance reasons.<br>
<!-- -->If you have implemented your own painter classes you need to adapt to this new interface. Read more in the <a href="/4.21/zh-CN/docs/development/ui-development/touchgfx-engine-features/canvas-widgets">article</a> on Canvas Widgets.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="painter-implementation-moved-to-generated-files">Painter implementation moved to generated files<a class="hash-link" href="#painter-implementation-moved-to-generated-files" title="直接链接到标题">​</a></h3><p>In TouchGFX 4.20 the software routines that paint circles, lines, and other shapes have been moved from the framework code to the code generated by CubeMX. This means that you have to regenerate code in CubeMX after upgrading a project from TouchGFX 4.19.1 (or earlier) to TouchGFX 4.20. The reason for this change is to be able to use the graphics accelerator, DMA2D, when drawing circles and lines.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="instructions">Instructions<a class="hash-link" href="#instructions" title="直接链接到标题">​</a></h4><p>Find and open the .ioc file in the project root folder:</p><div class="figure"><a href="/4.21/zh-CN/img/miscellaneous/known-issues/project-root-ioc.webp" target="_blank"><img src="/4.21/zh-CN/img/miscellaneous/known-issues/project-root-ioc.webp"></a><p>Project IOC file</p></div><p>Select TouchGFX 4.20 in the Software Packs Component Selector (alt-O):</p><div class="figure"><a href="/4.21/zh-CN/img/miscellaneous/known-issues/xcube-tgfx-420-selected.webp" target="_blank"><img src="/4.21/zh-CN/img/miscellaneous/known-issues/xcube-tgfx-420-selected.webp"></a><p>Selecting TouchGFX 4.20</p></div><p>Close this dialog and press &quot;Generate Code&quot; in upper right corner. Now go to the TouchGFX Designer and regenerate code (F4).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="linker-errors">Linker errors<a class="hash-link" href="#linker-errors" title="直接链接到标题">​</a></h4><p>If you don&#x27;t regenerate the code you will get linker errors if your project uses e.g. the Circle widget. The errors looks like this (here for 16bpp):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Linking TouchGFX/build/bin/target.elf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Middlewares/ST/touchgfx/lib/core/cortex_m7/gcc\libtouchgfx.a(PainterRGB565.o): In function `touchgfx::PainterRGB565::paint(unsigned char*, short, short, short, short, unsigned char) const&#x27;:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(.text._ZNK8touchgfx13PainterRGB5655paintEPhssssh+0x1a): undefined reference to `touchgfx::paint::rgb565::lineFromColor(unsigned short*, unsigned int, unsigned long, unsigned char, unsigned long)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Middlewares/ST/touchgfx/lib/core/cortex_m7/gcc\libtouchgfx.a(PainterRGB565.o): In function `touchgfx::PainterRGB565::tearDown() const&#x27;:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(.text._ZNK8touchgfx13PainterRGB5658tearDownEv+0x0): undefined reference to `touchgfx::paint::rgb565::tearDown()&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">collect2.exe: error: ld returned 1 exit status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For 24bpp:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Linking TouchGFX/build/bin/target.elf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Middlewares/ST/touchgfx/lib/core/cortex_m7/gcc\libtouchgfx.a(PainterRGB888.o): In function `touchgfx::PainterRGB888::paint(unsigned char*, short, short, short, short, unsigned char) const&#x27;:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        (.text._ZNK8touchgfx13PainterRGB8885paintEPhssssh+0x18): undefined reference to `touchgfx::paint::rgb888::lineFromColor(unsigned char*, unsigned int, unsigned long, unsigned char)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Middlewares/ST/touchgfx/lib/core/cortex_m7/gcc\libtouchgfx.a(PainterRGB888.o): In function `touchgfx::PainterRGB888::tearDown() const&#x27;:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        (.text._ZNK8touchgfx13PainterRGB8888tearDownEv+0x0): undefined reference to `touchgfx::paint::rgb888::tearDown()&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        collect2.exe: error: ld returned 1 exit status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The missing functions are generated into <code>TouchGFX/target/generated/STM32DMA.cpp</code>, when you regenerate code in CubeMX.</p><p>If your controller does not have DMA2D (or it is not enabled), CubeMX will include the software routines that was used in TouchGFX 4.19.1 and previous versions.</p><p>If you for some reason cannot regenerate code in CubeMX, you can manually add the missing functions by inserting the following includes in a .cpp file in your application:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;touchgfx/hal/Paint.hpp&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;touchgfx/hal/PaintRGB565Impl.hpp&gt; // 16bpp painting routines</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;touchgfx/hal/PaintRGB888Impl.hpp&gt; // 24bpp painting routines</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="debugging-stm32g0-with-keil">Debugging STM32G0 with Keil<a class="hash-link" href="#debugging-stm32g0-with-keil" title="直接链接到标题">​</a></h3><p>TouchGFX projects for STM32G0 boards with the X-NUCLEO-GFX01M1/2 display modules uses the address range from 0x90000000 for data in the external SPI flash. This breaks the Keil debugger as it tries to access these addresses when starting a debug session. Keil gives the error &quot;Cannot access target. Shutting down debug session.&quot;</p><div class="figure"><a href="/4.21/zh-CN/img/miscellaneous/known-issues/stm32g0-debugging-keil.webp" target="_blank"><img src="/4.21/zh-CN/img/miscellaneous/known-issues/stm32g0-debugging-keil.webp"></a><p>Starting a debug session in Keil</p></div><p>The solution is to create a init script for the debugger, with the text:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">load STM32G071_NUCLEO\STM32G071_NUCLEO.axf NOCODE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">g,main</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The NOCODE option tells Keil to not load the code. This removes the access problem.</p><div class="figure"><a href="/4.21/zh-CN/img/miscellaneous/known-issues/debug-ini.webp" target="_blank"><img src="/4.21/zh-CN/img/miscellaneous/known-issues/debug-ini.webp"></a><p>Debug initialization script for Keil</p></div><p>And select the file in the debug configuration dialogue:</p><div class="figure"><a href="/4.21/zh-CN/img/miscellaneous/known-issues/keil-debug-dialog.webp" target="_blank"><img src="/4.21/zh-CN/img/miscellaneous/known-issues/keil-debug-dialog.webp"></a><p>Debug configuration for Keil</p></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="compiling-stm32u5-and-stm32l5-projects-with-keil">Compiling STM32U5 and STM32L5 projects with Keil<a class="hash-link" href="#compiling-stm32u5-and-stm32l5-projects-with-keil" title="直接链接到标题">​</a></h3><p>Keil projects created with CubeMx are missing the DSP extension tag in the project file. This gives linker error when linking with the TouchGFX library, which has the DSP extension tag set. The linker errors will be like:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">STM32U575ZI_NUCLEO\STM32U575ZI_NUCLEO.axf: Error: L6366E: abstractpartition.o attributes are not compatible with the provided attributes.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Object abstractpartition.o contains Build Attributes that are incompatible with the provided attributes.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Tag_DSP_extension = This code was permitted to use Thumb DSP functions as an optional architecture extension above the base architecture as indicated by Tag_CPU_arch (=1)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The solution is to add the DSP tag in your .uvprojx project file (in the /Project/Targets/Target/TargetOption/TargetCommonOption/Cpu XML-element):</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Targets</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Target</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">TargetName</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">STM32U575ZI_NUCLEO</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">TargetName</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ToolsetNumber</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token number" style="color:rgb(247, 140, 108)">0x4</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">ToolsetNumber</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ToolsetName</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">ARM</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">ADS</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">ToolsetName</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">pCCUsed</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token number" style="color:rgb(247, 140, 108)">6120000</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">V6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">\ARMCLANG</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">pCCUsed</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">uAC6</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">uAC6</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">TargetOption</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">TargetCommonOption</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Device</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">STM32U575ZITx</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">Device</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Vendor</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">STMicroelectronics</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">Vendor</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">PackID</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">Keil</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">STM32U5xx_DFP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">PackID</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">PackURL</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">https</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//www.keil.com/pack/&lt;/PackURL&gt;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Cpu</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">IRAM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0x20000000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0x200BFFFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">IROM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0x08000000</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0x81FFFFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">CLOCK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">8000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">FPU3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SFPU</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">CPUTYPE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Cortex-M33&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> ELITTLE TZ DSP</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">Cpu</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">FlashUtilSpec</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">FlashUtilSpec</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="logonserver-environment-variable">LOGONSERVER environment variable<a class="hash-link" href="#logonserver-environment-variable" title="直接链接到标题">​</a></h3><p>We have observed on a few computers that the TouchGFX is very slow (e.g. &quot;Run simulator&quot; does nothing for 30 seconds). It may help to set the environment variable LOGONSERVER to an empty value.</p><p>In bash, the command is:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">export LOGONSERVER=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-4-19-0">TouchGFX 4.19.0<a class="hash-link" href="#touchgfx-4-19-0" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stm32cubemx-code-generation-with-mjpeg-video-on-h7">STM32CubeMX code generation with MJPEG Video on H7<a class="hash-link" href="#stm32cubemx-code-generation-with-mjpeg-video-on-h7" title="直接链接到标题">​</a></h3><p>When generating code with MJPEG Video on e.g. an STM32H750 with STM32CubeMX 6.3.0 or earlier, unfortunately, the code to configure the MDMA to the MDMA handlers, as shown in <a href="/4.21/zh-CN/docs/development/touchgfx-hal-development/scenarios/scenarios-video-decoding#stm32h750-dk">Video Decoding</a>, is missing and developers must add the highlighted user code manually:</p><div class="code-header"><div><h5>Core\Src\stm32h7xx_hal_msp.c</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">HAL_JPEG_MspInit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">JPEG_HandleTypeDef</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> hjpeg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">hjpeg</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">Instance</span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain">JPEG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN JPEG_MspInit 0 */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">     hmdma_jpeg_infifo_th</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Request </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> MDMA_REQUEST_JPEG_INFIFO_TH</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">     hmdma_jpeg_outfifo_th</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Request </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> MDMA_REQUEST_JPEG_OUTFIFO_TH</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END JPEG_MspInit 0 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用字体排印的新方法">使用字体排印的新方法<a class="hash-link" href="#使用字体排印的新方法" title="直接链接到标题">​</a></h3><p>从TouchGFX 4.18.1到TouchGFX 4.19.0，字体排印的使用发生了变化。 现在，字体排印有一个默认设置和零或多个特定语言设置。</p><p>在Designer指南中 <a href="/4.21/zh-CN/docs/development/ui-development/designer-user-guide/texts-view">了解更多相关信息</a></p><p>文本特定的方向和字体排印不再是一个选项，这些选项转移到了新的默认设置和特定语言设置中。 该项新功能会对使用该功能的项目生成的代码产生影响。 文本转换器将为默认设置生成一个字体id，并为每种特定语言设置生成一个id。 根据特定语言设置生成的字体id将被自动命名，参见下面示例。</p><div class="figure"><a href="/4.21/zh-CN/img/miscellaneous/known-issues/text-specific-direction.webp" target="_blank"><img src="/4.21/zh-CN/img/miscellaneous/known-issues/text-specific-direction.webp"></a><p>在TouchGFX 4.18中设置特定的文本方向和字体排印</p></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例自动生成的字体id">示例：自动生成的字体id<a class="hash-link" href="#示例自动生成的字体id" title="直接链接到标题">​</a></h4><ul><li>默认字体排印id: 标题</li><li>特定语言设置: JPN</li></ul><p>在<code>generated/fonts/include/fonts/ApplicationFontProvider.hpp</code>中生成两个字体ID：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">TypographyFontIndex</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> touchgfx</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">FontId HEADLINE </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> touchgfx</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">FontId HEADLINE_AUTO_GENERATED_FOR_JPN </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="升级到4190时自动生成的字体排印">升级到4.19.0时自动生成的字体排印<a class="hash-link" href="#升级到4190时自动生成的字体排印" title="直接链接到标题">​</a></h4><p>如前所述，文本特定的方向和字体排印不再是一个选项。 由于功能上的这一变化，在升级旧版本时，可能会生成具有默认和特定语言设置的新字体排印。 您可以通过id来识别这些自动生成的字体排印。 文本方向作为后缀或A-Z范围内的字母:</p><ul><li>Headline_LTR</li><li>PosterText_RTL</li><li>Title_A</li><li>ButtonText_B</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="在用户代码中引用字体id">在用户代码中引用字体id<a class="hash-link" href="#在用户代码中引用字体id" title="直接链接到标题">​</a></h4><p>如果在用户代码中引用字体id，则可能需要对其进行更新。 当字体id不是通过符号而是通过值引用的情况下，会有出错的风险，因为在升级期间字体id可能会更改。 建议始终通过符号引用字体id，即：用<code>TypographyFontIndex::HEADLINE</code>而非<code>0</code>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="将libjpeg与armclang结合使用">将LibJPEG与ARMCLANG结合使用<a class="hash-link" href="#将libjpeg与armclang结合使用" title="直接链接到标题">​</a></h3><p>在CubeMX中选择了LibJPEG中间件的ARMCLANG项目无法运行。 ARMCLANG启用半托管，因为LibJPEG引用libc文件函数（如：fopen）。<br>
<!-- -->半托管使应用程序在启动时等待与半托管感知调试器连接。<br>
<!-- -->解决此问题的一种方法是取消两个文件中对JFILE的定义来删除对LibJPEG中fopen的引用：<code>LibJPEG/source/jdatasrc.c</code> and <code>LibJPEG/source/jdatadst.c</code>:</p><div class="code-header"><div><h5>LibJPEG/source/jdatasrc.c</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;jerror.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">undef</span><span class="token macro property"> </span><span class="token macro property expression">JFILE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Expanded data source object for stdio input */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifdef</span><span class="token macro property"> </span><span class="token macro property expression">JFILE </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="code-header"><div><h5>LibJPEG/source/jdatadst.c</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;jerror.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">undef</span><span class="token macro property"> </span><span class="token macro property expression">JFILE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">HAVE_STDLIB_H       </span><span class="token macro property comment" style="color:rgb(105, 112, 152);font-style:italic">/* &lt;stdlib.h&gt; should declare malloc(),free() */</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="h750b-discovery上的mjpeg视频">H750B Discovery上的MJPEG视频<a class="hash-link" href="#h750b-discovery上的mjpeg视频" title="直接链接到标题">​</a></h3><p>H750B Discovery板使用YCbCr视频数据的硬件解码。 TouchGFX为该板提供的代码中的一个错误导致某些视频播放会出现虚影。<br>
<!-- -->解决方案是改为软件解码。 在某些情况下，也可以通过修改视频的宽度几个像素来解决问题。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="threadx汇编程序文件">ThreadX汇编程序文件<a class="hash-link" href="#threadx汇编程序文件" title="直接链接到标题">​</a></h3><p>Keil IDE的ThreadX汇编程序文件使用新的ARMCLANG V6汇编程序语法。 某些固件包中提供的startup.s文件使用的是旧的ARMCC汇编程序语法。  这意味着您必须将项目设置为使用ARMCLANG V6汇编程序，然后针对startup_stm32xxx.s进行重写:</p><div class="figure"><a href="/4.21/zh-CN/img/miscellaneous/known-issues/keil-assembler.webp" target="_blank"><img src="/4.21/zh-CN/img/miscellaneous/known-issues/keil-assembler.webp"></a><p>取消选择用于startup.s的ARMCLANG V6汇编程序</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-4-18-0">TouchGFX 4.18.0<a class="hash-link" href="#touchgfx-4-18-0" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="issues-with-cubemx-610-and-cubeprogrammer-26">CubeMX 6.1.0和CubeProgrammer 2.6的问题<a class="hash-link" href="#issues-with-cubemx-610-and-cubeprogrammer-26" title="直接链接到标题">​</a></h3><p>由于“C/C++编译器” / “语言”选项的错误设置（从“自动”更改为“C++”导致编译错误），CubeMX生成的CubeMX 版本6.1.0 EWARM工程不能与X-CUBE-TOUCHGFX一起使用。 此问题将在CubeMX 6.1.1中进行修正。 在此期间，将选项手动改回“自动”将解决编译问题，但是会在CubeMX生成代码时还原。</p><p>CubeProgrammer 2.6中与外部加载器 (<code>.stldr</code>)引用方式相关的问题会损坏所有现有应用模板（AT）的Makefile，还会妨碍TouchGFX Designer中“运行目标”功能的正常工作。 此问题还扩展到了基于最新AT版本的用户工程。 应用程序模板将更新以修补该问题，并将适用于CubeProgrammer 2.5和2.6。 如果您已有不能与CubeProgrammer 2.6一起使用的基于AT的工程，您可以进行下列修改以添加支持。 在引用外部文件夹时，用户必须从<code>bin</code>文件夹执行<code>STM32CubeProgrammer_CLI.exe</code>。 一般而言，指：</p><ul><li><code>cd</code>进入STM32CubeProgrammer安装文件夹中的<code>bin</code>文件夹。</li><li>执行命令，通过对<code>.stldr</code>文件的<em>相对</em>引用对连接的目标硬件进行烧录。</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@cd &quot;$(st_stm32cube_programmer_bin_path)&quot; &amp;&amp; ./$(stm_stm32cube_programmer_exe) -c port=SWD -d $(application_path)/$(binary_output_path)/target.hex -el $(stm32cubeLoader_relative_path) -hardRst</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">CubeProgrammer错误在2.10版中得到解决。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-touchgfx-format">新的.touchgfx格式<a class="hash-link" href="#new-touchgfx-format" title="直接链接到标题">​</a></h3><p>从TouchGFX 4.17.0到TouchGFX 4.18.0，.touchfgx文件的内容主要在两个方面做了重大改变。 其后果会全面更新.touchfgx文件，只需使用TouchGFX Designer打开TouchGFX工程文件，然后保存即可。 主要变化在以下领域：</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="default-values-are-not-written-to-touchgfx">默认值不再写入 .touchgfx文件<a class="hash-link" href="#default-values-are-not-written-to-touchgfx" title="直接链接到标题">​</a></h4><p>具有默认值（例如框体偏移量X=0，Y=0 或黑色（red=0，green=0，blue=0））的控件参数之前被写入.touchfgx文件；但在TouchGFX版本4.18.0中，这些值不再写入。 其结果会导致稍小些的.touchgfx文件。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="removed-textentries-block">删除了TextEntries块<a class="hash-link" href="#removed-textentries-block" title="直接链接到标题">​</a></h4><p>重命名了SingleUseId，其名称现包含随机数字和字母（而不是连续的数字），这会简化合并几个活跃的开发人员共同开发的同一工程的工作，因为新的一次性使用文本id不会获得重复的id。 另外，.touchgfx中的“TextEntries”部分已被删除，这带来.touchgfx文件尺寸大大减少。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lcd16bpp-fillrect-and-lcd16bpp-drawglyph">LCD16bpp::fillRect与LCD16bpp::drawGlyph<a class="hash-link" href="#lcd16bpp-fillrect-and-lcd16bpp-drawglyph" title="直接链接到标题">​</a></h3><p>LCD16bpp中的fillRect和drawGlyph函数现在用完整的24位颜色（而非缩减后的16位（RGB565）颜色）传递给DMA。 这可能会导致硬件（非模拟器）上出现错误的颜色，可以通过CubeMX重新生成DMA类来修复该问题。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="makefile-and-xlsx">Makefile和xlsx<a class="hash-link" href="#makefile-and-xlsx" title="直接链接到标题">​</a></h3><p>TouchGFX 4.18.0使用新的.xml格式（而不是以前使用的旧的.xlsx格式）来存储文本和译文。 这意味着Makefiles和visual studio项目中所有对&quot;text .xlsx&quot;的引用都应该改为&quot;text .xml&quot;。 TextConvert工具可以自动识别，即使旧的texts.xlsx文件存在而texts.xml不存在，其会将texts.xlsx转换为texts.xml，以适应所有未来的使用。</p><p>要查看能正常工作的新Makefile，只需使用TouchGFX Designer新建一个（空白）项目，文件位于文件夹generated/simulator/gcc/Makefile中。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="textsxsd中的字体大小限制">texts.xsd中的字体大小限制<a class="hash-link" href="#textsxsd中的字体大小限制" title="直接链接到标题">​</a></h3><p>Designer中用于验证texts.xml的texts.xsd的字体大小有255的限制。 如果字体大于255，您将在Designer中看到如下错误消息:</p><div class="figure"><a href="/4.21/zh-CN/img/miscellaneous/known-issues/font-size-limit-xsd.webp" target="_blank"><img src="/4.21/zh-CN/img/miscellaneous/known-issues/font-size-limit-xsd.webp"></a><p>错误消息-字体大小限制</p></div><p>解决方法是关闭工程，将texts.xsd中的“字体大小”属性从xs:unsignedByte更改为xs:unsignedInt，然后重新打开工程。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sdl2-linker-error-on-linux">Linux上的SDL2链接器错误<a class="hash-link" href="#sdl2-linker-error-on-linux" title="直接链接到标题">​</a></h3><p>现在只为Windows用户提供仿真器使用的SDL2库。 Linux用户需要自己安装SDL2库。 仅需要执行一次的命令，对于ubuntu，命令是</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo apt install libsdl2-dev libsdl2-image-dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>即可安装libsdl2和libsdl2-image，包含开发所用的头文件。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-4-17-0">TouchGFX 4.17.0<a class="hash-link" href="#touchgfx-4-17-0" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="painters-no-longer-support-setalpha">绘图工具不再支持setAlpha()<a class="hash-link" href="#painters-no-longer-support-setalpha" title="直接链接到标题">​</a></h3><p>出于性能方面的考虑，Canvas Widget Renderer（CWR）使用的绘图控件不再支持alpha。 通过在有绘图控件的画布控件上设置alpha，仍然可以达到效果。 一般而言，可以将下面这样的代码：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">painter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setColor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Color</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getColorFromRGB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0xFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">painter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setAlpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">128</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">circle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setPainter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">painter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改成这样：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">painter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setColor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Color</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getColorFromRGB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0xFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">circle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setPainter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">painter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">circle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setAlpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">128</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果之前将alpha应用于绘图控件和画布控件，可以将这两个alpha值相乘，然后除以255，如下所示：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">painter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setColor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Color</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getColorFromRGB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0xFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">painter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setAlpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">painterAlpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">circle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setPainter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">painter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">circle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setAlpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">circleAlpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> 变成</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">painter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setColor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Color</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getColorFromRGB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0xFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">circle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setPainter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">painter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">circle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setAlpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">painterAlpha </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> circleAlpha</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">255</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者使用LCD::div255()替代除以255。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-hal-class">使用HAL类<a class="hash-link" href="#using-the-hal-class" title="直接链接到标题">​</a></h3><p>在版本4.17.0之前，完全不使用HAL的TouchGFX框架中的多个文件包含头文件touchgfx/hal/HAL.hpp。 这可能导致用户代码由于编译器不知道HAL而不进行编译。这些不必要的引用现已清理。 为了修正这个问题，只需包含HAL头文件，如下所示：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;touchgfx/hal/HAL.hpp&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另外，Screen类有两个新函数getScreenWidth() 和getScreenHeight()，用于给出屏幕尺寸。 推荐该方法用来获得屏幕尺寸，可从Screen的任意子类（如Screen1View.cpp）直接调用。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fmc-display-interface-in-touchgfx-generator">TouchGFX Generator中的FMC显示接口<a class="hash-link" href="#fmc-display-interface-in-touchgfx-generator" title="直接链接到标题">​</a></h3><p>当使用TouchGFX Generator中新的FMC显示接口时，用CubeMX 6.2.1生成时FMC存储区的<em>内存偏移</em>是不正确的（零）。 这会在CubeMX 6.3.0中修正，在发布时，X-CUBE-TouchGFX需要的最低版本将跳至6.3.0而不是目前的6.2.1。 到那时，用户可以在<code>TouchGFXGeneratedHAL.cpp</code>中输入正确的FMC BANK存储地址（将在重新生成时被覆盖）。 如</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">FMC_BANK1_REG</span><span class="token macro property"> </span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression keyword" style="font-style:italic">uint16_t</span><span class="token macro property expression"> </span><span class="token macro property expression operator" style="color:rgb(137, 221, 255)">*</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression"> </span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">0x60000000</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">FMC_BANK1_MEM</span><span class="token macro property"> </span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression keyword" style="font-style:italic">uint16_t</span><span class="token macro property expression"> </span><span class="token macro property expression operator" style="color:rgb(137, 221, 255)">*</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression"> </span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">0x60000002</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>用户还可以在<code>TouchGFXHAL.cpp</code>中全部重新定义它们。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="l8-images-in-16-24-or-32bpp-configurations">16-24或32bpp配置的L8图像<a class="hash-link" href="#l8-images-in-16-24-or-32bpp-configurations" title="直接链接到标题">​</a></h3><p>在加载L8图像的CLUT时，对<code>OSWrappers::taskYield()</code> 的调用被错误地引入了STM32DMA类。 要解决此问题，用户可以执行以下操作：</p><ol><li>导航到您的<code>Users/&lt;user name&gt;/STM32Cube/Repository/Packs/STMicroelectronics/X-CUBE-TOUCHGFX/4.17.0/CubeMX/templates/Target</code>文件夹。</li><li>根据您的位深打开相应的<code>dma\u Xbpp\u implementation\u tmp.ftl</code>文件</li><li>删除或注释<code>while ((READ_REG(DMA2D-&gt;FGPFCCR) &amp; DMA2D_FGPFCCR_START) != 0U)</code>循环中对 <code>OSWrappers::taskYield()</code>的调用，并从STM32CubeMX重新生成代码，以使用此修改的模板生成代码。</li></ol><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">READ_REG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">DMA2D</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">FGPFCCR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> DMA2D_FGPFCCR_START</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// OSWrappers::taskYield();</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-4150">TouchGFX 4.15.0<a class="hash-link" href="#touchgfx-4150" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mcu-support">支持的MCU<a class="hash-link" href="#mcu-support" title="直接链接到标题">​</a></h3><p>虽然TouchGFX完全支持Cortex-M33，但在CubeMX中添加支持前，当前CubeMX（v6.0.1）版本中不能启用多上下文MCU的“软件包”（包括TouchGFX Generator）。 对基于Cortex-M33的MCU禁用“Trust Zone”，从而将MCU限制在单上下文，将允许您启用TouchGFX Generator。 应在“用户代码”区手动使能TrustZone。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-4140">TouchGFX 4.14.0<a class="hash-link" href="#touchgfx-4140" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="armclang-support">ARMCLANG支持<a class="hash-link" href="#armclang-support" title="直接链接到标题">​</a></h3><p>虽然TouchGFX现在为<em>Cortex-M0</em>、<em>Cortex-M4f</em>、<em>Cortex-M7</em>和<em>Cortex-M33</em>提供ARMCLANG（ARM编译器v6.x）库，CubeMX却不能生成启用ARMCLANG编译器（ARM编译器v6.x）的工程。 想在其工程中使用该编译器的用户需要在Keil uVision中的工程选项中手动选择编译器。</p><p>如果在CubeMX内配置FreeRTOS中间件，生成的任何使用ARMCC（ARM编译器v5.x）的工程都都会包含FreeRTOS<em>可移植</em>文件，这些文件与ARMCLANG是不兼容的；必须手工替换这些文件。 每当从CubeMX内部运行“生成代码”时，任何手工修改都会被覆盖，最好在版本控制（git等）下维护工程，以便撤销这些特定修改。</p><p>总之， 由于CubeMX只能生成使用ARM Compiler v5.x编译器的工程，因此用户每次从CubeMX生成代码时必须修改下列内容，在版本控制下维护项目除外。</p><ol><li>在工程选项中选择ARM Compiler v6.x。</li><li>链接ARMCLANG库而不是ARMCC库（通过CubeMX配置）。</li><li>如果在CubeMX内配置FreeRTOS，为了兼容ARM Compiler v6.x，应从<code>portable/GCC</code>文件夹获取FreeRTOS可移植文件，而不是<code>portable/RVDS</code>文件夹（ARM Compiler v5.x的默认选择）。</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="workflow">工作流程<a class="hash-link" href="#workflow" title="直接链接到标题">​</a></h4><p>下列流程描述了如何在Keil uVision中对CubeMX生成的工程使用v6.x ARM 编译器和TouchGFX ARMCLANG库。</p><ol><li>在Keil uVision中选择ARMCLANG（v. 6.x）。</li></ol><div class="figure noshadow"><a href="/4.21/zh-CN/img/miscellaneous/known-issues/armclang-support.webp" target="_blank"><img width="650" src="/4.21/zh-CN/img/miscellaneous/known-issues/armclang-support.webp"></a><p>ARMCLANG支持</p></div><ol start="2"><li><p>如果您在CubeMX中配置了FreeRTOS，CubeMX将生成错误的可移植文件，并将您的工程配置为使用这些文件。 您必须使用来自<a href="https://github.com/FreeRTOS/FreeRTOS-Kernel/tree/6199b72fbf57a7c5b3d7b195a3bd1446779314cd/portable/GCC%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%88%60port.c%60%E5%92%8C%60portmacro.h%60%EF%BC%89%E6%88%96%E4%B8%8B%E8%BD%BD%E4%B8%80%E4%B8%AAFreeRTOS%E7%89%88%E6%9C%AC%E5%B9%B6%E4%BB%8E%E4%B8%AD%E6%89%BE%E5%88%B0%E7%9B%B8%E5%BA%94%E6%96%87%E4%BB%B6%E6%9D%A5%E6%89%8B%E5%B7%A5%E6%9B%BF%E6%8D%A2%E3%80%82" target="_blank" rel="noopener noreferrer">https://github.com/FreeRTOS/FreeRTOS-Kernel/tree/6199b72fbf57a7c5b3d7b195a3bd1446779314cd/portable/GCC的文件（`port.c`和`portmacro.h`）或下载一个FreeRTOS版本并从中找到相应文件来手工替换。</a></p><p>替换<code>port.c</code>： </p><div class="figure noshadow"><a href="/4.21/zh-CN/img/miscellaneous/known-issues/keil-port-c.webp" target="_blank"><img width="250" src="/4.21/zh-CN/img/miscellaneous/known-issues/keil-port-c.webp"></a><p>port.c</p></div><p></p><p>将include路径设置修改为包含<code>portable/GCC</code>文件夹中的<code>portmacro.h</code>（本例中以Cortex-M7为例）： </p><div class="figure noshadow"><a href="/4.21/zh-CN/img/miscellaneous/known-issues/keil-port-include.webp" target="_blank"><img width="600" src="/4.21/zh-CN/img/miscellaneous/known-issues/keil-port-include.webp"></a><p>可移植文件包含路径</p></div><p></p></li><li><p>“生成代码”期间中，TouchGFX Designer生成后步骤会根据您选择的编译器版本自动插入正确的库。</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-4130">TouchGFX 4.13.0<a class="hash-link" href="#touchgfx-4130" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bugs">错误<a class="hash-link" href="#bugs" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="font-converter">字体转换器<a class="hash-link" href="#font-converter" title="直接链接到标题">​</a></h4><p>FontConverter工具会为unicodes码生成字形像素数据，这是字体规则的一部分，而无论该字形是否在应用中实际文本中用到。 这可能会导致数兆字节的额外字形像素数据。 这里可以找到不会为应用中未使用的字形生成像素数据的FontConverter新工具（Windows和Linux）：</p><ul><li><a href="http://sw-center-st-com.s3-eu-west-1.amazonaws.com/touchgfx/TouchGFX/Patches/4.13.0/fontconvert_fix.zip" target="_blank" rel="noopener noreferrer">fontconvert_fix.zip</a></li></ul><p>在4.13.0安装的根目录下提取该压缩文件将更新touchgfx\framework\tools内部的fontconverter库</p><p><code>touchgfx\framework\tools</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-compiler-support">额外编译器支持<a class="hash-link" href="#additional-compiler-support" title="直接链接到标题">​</a></h3><p>用ARMCLANG编译器（v6.12）构建的库可以在这里找到：</p><ul><li><a href="http://sw-center-st-com.s3-eu-west-1.amazonaws.com/touchgfx/TouchGFX/Patches/4.13.0/touchgfx_core_clang.zip" target="_blank" rel="noopener noreferrer">touchgfx_core_clang.zip</a></li></ul><p>在4.13.0安装的根目录提取此文件可将库<code>touchgfx_core_clang.lib</code>置入</p><p><code>touchgfx\lib\core\cortex_m7\Keil</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backwards-compatibility">向后兼容<a class="hash-link" href="#backwards-compatibility" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="deprecated-features">已弃用的功能<a class="hash-link" href="#deprecated-features" title="直接链接到标题">​</a></h4><p>下列弃用的功能已经被移除了。 如果您在代码中引用了它们，您可能需要重新编写应用中的这部分内容：</p><ul><li>已弃用的 <code>TRANSPARENT_COL</code>定义</li><li><code>Drawable::getType()</code></li><li><code>HAL::blitSetTransparencyKey()</code></li><li><code>HAL::registerTextCache()</code></li><li><code>HAL::cacheTextString()</code></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="texturemapper-is-disabled-by-default">默认禁用TextureMapper<a class="hash-link" href="#texturemapper-is-disabled-by-default" title="直接链接到标题">​</a></h4><p>默认禁用TextureMapper，以消减TouchGFX使用的代码空间。 TouchGFX designer会在所有新工程中插入代码，以启用纹理映射器。</p><p>如果您将旧工程移植到TouchGFX 4.13，并更新至TouchGFX 4.13，将由TouchGFX Designer处理这些问题。</p><p>如果是手工更新，则需要插入代码来启用TextureMapper。 否则，将不会在屏幕上绘制任何TextureMapper。</p><p>阅读更多内容：<a href="/4.21/zh-CN/docs/development/ui-development/designer-user-guide/config-view#framework-features">配置TouchGFX特性</a>。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hal-sdl1-incompatible">不兼容HAL SDL1<a class="hash-link" href="#hal-sdl1-incompatible" title="直接链接到标题">​</a></h4><p>有两个函数从TouchGFX库代码移到了<code>HALSDL2.cpp</code>。 这对将<code>HALSDL2.cpp</code>用在Windows模拟器的HAL应用而言没有分别。</p><p>如果您有一个老应用（早于TouchGFX 4.8.0），则您的模拟器可能是在使用HALSDL（非2）。 此模拟器HAL不再包含在TouchGFX中。 HALSDL缺失了之前包含在TouchGFX库中的两个函数。 您需要将它们手动添加到<code>HALSDL.cpp</code>：</p><div class="code-header"><div><h5>HALSDL.cpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">simulator_enable_stdio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">simulator_enable_stdio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    HWND consoleHwnd </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">GetConsoleWindow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Get handle of console window</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">consoleHwnd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">                      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// No console window yet?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        HWND activeHwnd </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">GetActiveWindow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Remember which window is active</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">AllocConsole</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">                   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Allocate a new console</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        consoleHwnd </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">GetConsoleWindow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Get handle of console window</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        FILE</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">freopen_s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CONIN$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;r&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">stdin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Redirect stdin/stdout/stderr to the new console</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">freopen_s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CONOUT$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;w&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">stdout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">freopen_s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CONOUT$&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;w&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">stderr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">SwitchToThisWindow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">activeHwnd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Switch back to the originally active window</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">consoleHwnd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">ShowWindow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">consoleHwnd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> SW_SHOW</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Show/hide it!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">simulator_printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> va_list pArg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">simulator_printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> va_list pArg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Create a console window, if window is visible.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">simulator_enable_stdio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">GetConsoleWindow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Only print if we have a console window</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">vprintf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> pArg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-4123">TouchGFX 4.12.3<a class="hash-link" href="#touchgfx-4123" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backwards-compatibility-1">向后兼容<a class="hash-link" href="#backwards-compatibility-1" title="直接链接到标题">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="screen-transitions">屏幕切换<a class="hash-link" href="#screen-transitions" title="直接链接到标题">​</a></h4><p>更早的版本在完成屏幕切换后重绘整个屏幕。 额外的重绘在一些较慢的平台上会导致了性能问题。 如果您出于某些原因需要此类重绘，则需要使屏幕的相关部分失效，例如，在切换到的屏幕的虚函数<code>Screen::afterTransition()</code>中调用<code>container.invalidate()</code>。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="binary-fonts">二进制字体<a class="hash-link" href="#binary-fonts" title="直接链接到标题">​</a></h4><p>由于字距调整数据现已包含在二进制字体中，因而修改了二进制字体的格式。 需要重新生成二进制字体文件，原有的老文件会工作不正常。 根据Makefiles的设置方式，通常可以通过重新生成所有资源来完成（如<code>“make -f simulator/gcc/Makefile clean assets”</code>）。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-4110">TouchGFX 4.11.0<a class="hash-link" href="#touchgfx-4110" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backwards-compatibility-2">向后兼容<a class="hash-link" href="#backwards-compatibility-2" title="直接链接到标题">​</a></h3><p>在<code>touchgfx/framework/include/touchgfx/lcd/LCD.hpp</code>中，我们删除了头文件<code>touchgfx/hal/HAL.hpp</code>，这个是在早期版本中误插入的。 这可能会导致包含<code>LCD.hpp</code>并使用<code>HAL.hpp</code>内容的文件发生编译错误。 解决方案是在您的文件中也包含进<code>touchgfx/framework/include/touchgfx/hal/HAL.hpp</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-4100">TouchGFX 4.10.0<a class="hash-link" href="#touchgfx-4100" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="upgrading-from-49x">从4.9.x升级<a class="hash-link" href="#upgrading-from-49x" title="直接链接到标题">​</a></h3><p>从版本4.10.0开始，TouchGFX只在STM32 MCU上运行。</p><p>如需更新老项目，您需要执行下列操作。</p><p>在应用启动时添加下面突出显示的代码，以通知TouchGFX正在STM32硬件上运行。 合适的添加位置是<code>BoardConfiguration.cpp</code>中<code>hw_init()</code>函数的结尾处。</p><div class="code-header"><div><h5>BoardConfiguration.cpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">hw_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Enable CRC engine for STM32 Lock check</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">__HAL_RCC_CRC_CLK_ENABLE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backwards-compatibility-3">向后兼容<a class="hash-link" href="#backwards-compatibility-3" title="直接链接到标题">​</a></h3><p>删除了未使用的文件<code>\touchgfx\framework\include\touchgfx\canvas_widget_renderer\RGBA8.hpp</code>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="project-updater-issue">工程更新器的问题<a class="hash-link" href="#project-updater-issue" title="直接链接到标题">​</a></h3><p>从TouchGFX Designer调用的IAR和Keil工程更新器不遵循在相应IDE中设置的自定义文件级别优化。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="textarea-and-chromart-dma2d">TextArea和ChromART（DMA2D）<a class="hash-link" href="#textarea-and-chromart-dma2d" title="直接链接到标题">​</a></h3><p>用ChromART渲染TextAreas（当TextArea是最顶端的元素/最后进行绘制时）导致帧缓冲区提前解锁，继而导致当前帧提前完成/传输到显示屏。 在TouchGFX调用<code>endFrame()</code>后，所有绘制操作（包括DMA操作）应已完成。 由于TextArea在如何恰当地保护帧缓冲区方面违反该约定，即使从<code>endFrame()</code>返回后，仍然允许DMA操作继续。</p><p>控件的约定为：</p><ol><li>锁定帧缓冲（返回指向帧缓冲的指针）。</li><li>在帧缓冲中绘制一些内容。 </li><li>解锁帧缓冲区。</li></ol><p>或者，使用DMA操作，这种情况下将自动处理帧缓冲的同步。</p><p>在版本4.10.0中，如果是当前屏幕最顶端的元素（最后进行绘制），TextArea将两个流程混合可能导致短时间的故障。 该问题可通过用下列<code>endFrame()</code>重写手工保护<code>endFrame()</code>来修正（基于F4 HAL）。 此举确保如果ChromART操作仍在进行时<code>endFrame()</code>不返回。  </p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">STM32F4HAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">endFrame</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dma</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">isDMARunning</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 107)">OSWrappers</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">tryTakeFrameBufferSemaphore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">HAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">endFrame</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-490">TouchGFX 4.9.0<a class="hash-link" href="#touchgfx-490" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="upgrading-from-480">从4.8.0升级<a class="hash-link" href="#upgrading-from-480" title="直接链接到标题">​</a></h3><p>随着应用模板（从实质上将板支持包与核心框架分离开来）的引入，我们在版本4.9.0的<em>touchgfx</em>文件夹中删除了许多底层驱动和其他文件。 这些文件现在由应用模板提供。 但是，这也意味着您不能通过仅仅替换touchgfx文件夹来升级到4.9.0，那样做会导致一些BSP文件缺失。 反之，TouchGFX Designer能够自动执行升级。 可通过两种不同的方式升级，您需要确定哪种方式是适合。</p><div class="highlight highlight-caution"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></div>Caution</h5></div><div class="highlight-content">请确保升级前进行了工程备份。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="method-1-retain-original-file-structure">方法1：保留原始文件结构<a class="hash-link" href="#method-1-retain-original-file-structure" title="直接链接到标题">​</a></h3><p>使用该方法，只需在新的TouchGFX Designer 4.9.0中打开工程。 TouchGFX Designer将提示您是否要升级，在点击“确定”后，TouchGFX Designer将进行必要的修改。 TouchGFX Designer将执行下列操作：</p><ol><li>将新的压缩过的touchgfx文件夹解压到应用中，并修改TouchGFX路径以与之匹配。</li><li>下载并解压所有已从touchgfx文件夹中删除的文件，因此您的工程仍然可以通过编译。</li></ol><p>此方法几乎会让一切保持原样，如果原有文件结构适合您的工程，则这是最轻松的选择。 此方法的主要缺点是不会有图像转换器加速（通过操作图像文件夹而不是单个文件）。 但是，您可以手动修改makefile，以便使用此方法。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="method-2-import-into-new-template">方法2：导入到新的模板<a class="hash-link" href="#method-2-import-into-new-template" title="直接链接到标题">​</a></h3><p>您可以使用此方法将工程转换到基于新模板的文件结构中。 为此，您必须首先使用上面的方法1让Designer升级工程。 然后，使用合适的应用模板（模拟器或与您的评估板匹配的应用模板）新建工程。 在Designer中打开此新工程后，转至顶部菜单并点击“编辑-&gt;导入GUI”。 在对话框中指定工程的.touchgfx文件。 Designer会自动将所有UI文件（包括资源）导入新建的工程。 如果您在gui文件夹之外增加了额外的代码，您需要将这些文件手动复制到新工程。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="method-3-manual-upgrade-without-designer">方法3：手工升级（无TouchGFX Designer）<a class="hash-link" href="#method-3-manual-upgrade-without-designer" title="直接链接到标题">​</a></h3><p>如果不使用TouchGFX Designer，您可以用以下方式进行升级：</p><ol><li>用版本4.9.0的安装文件夹中的touchgfx文件夹替换您工程中使用的touchgfx文件夹。</li><li>下载<a href="http://ftp.draupnergraphics.com/TouchGFX/Evaluation/4.9.0/Qll3iKK54AnJer7XRNm2/fw_delta_4.8.0_4.9.0.zip" target="_blank" rel="noopener noreferrer">本zip</a>文件并将其解压到touchgfx文件夹，恢复删除的文件。</li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档页面导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/4.21/zh-CN/docs/miscellaneous/getting-help"><div class="pagination-nav__sublabel">上一个</div><div class="pagination-nav__label">获取帮助</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/4.21/zh-CN/docs/miscellaneous/changelog"><div class="pagination-nav__sublabel">下一个</div><div class="pagination-nav__label">修订日志</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#touchgfx-4-21-0" class="table-of-contents__link toc-highlight">TouchGFX 4.21.0</a><ul><li><a href="#widetextaction" class="table-of-contents__link toc-highlight">WideTextAction</a></li><li><a href="#compiling-stm32u599-projects-with-iar" class="table-of-contents__link toc-highlight">Compiling STM32U599 projects with IAR</a></li><li><a href="#svg-drawing-on-stm32-with-neochrom" class="table-of-contents__link toc-highlight">SVG drawing on STM32 with NeoChrom</a></li></ul></li><li><a href="#touchgfx-4-20-0" class="table-of-contents__link toc-highlight">TouchGFX 4.20.0</a><ul><li><a href="#painter-interface-changed" class="table-of-contents__link toc-highlight">Painter interface changed</a></li><li><a href="#painter-implementation-moved-to-generated-files" class="table-of-contents__link toc-highlight">Painter implementation moved to generated files</a></li><li><a href="#debugging-stm32g0-with-keil" class="table-of-contents__link toc-highlight">Debugging STM32G0 with Keil</a></li><li><a href="#compiling-stm32u5-and-stm32l5-projects-with-keil" class="table-of-contents__link toc-highlight">Compiling STM32U5 and STM32L5 projects with Keil</a></li><li><a href="#logonserver-environment-variable" class="table-of-contents__link toc-highlight">LOGONSERVER environment variable</a></li></ul></li><li><a href="#touchgfx-4-19-0" class="table-of-contents__link toc-highlight">TouchGFX 4.19.0</a><ul><li><a href="#stm32cubemx-code-generation-with-mjpeg-video-on-h7" class="table-of-contents__link toc-highlight">STM32CubeMX code generation with MJPEG Video on H7</a></li><li><a href="#使用字体排印的新方法" class="table-of-contents__link toc-highlight">使用字体排印的新方法</a></li><li><a href="#将libjpeg与armclang结合使用" class="table-of-contents__link toc-highlight">将LibJPEG与ARMCLANG结合使用</a></li><li><a href="#h750b-discovery上的mjpeg视频" class="table-of-contents__link toc-highlight">H750B Discovery上的MJPEG视频</a></li><li><a href="#threadx汇编程序文件" class="table-of-contents__link toc-highlight">ThreadX汇编程序文件</a></li></ul></li><li><a href="#touchgfx-4-18-0" class="table-of-contents__link toc-highlight">TouchGFX 4.18.0</a><ul><li><a href="#issues-with-cubemx-610-and-cubeprogrammer-26" class="table-of-contents__link toc-highlight">CubeMX 6.1.0和CubeProgrammer 2.6的问题</a></li><li><a href="#new-touchgfx-format" class="table-of-contents__link toc-highlight">新的.touchgfx格式</a></li><li><a href="#lcd16bpp-fillrect-and-lcd16bpp-drawglyph" class="table-of-contents__link toc-highlight">LCD16bpp::fillRect与LCD16bpp::drawGlyph</a></li><li><a href="#makefile-and-xlsx" class="table-of-contents__link toc-highlight">Makefile和xlsx</a></li><li><a href="#textsxsd中的字体大小限制" class="table-of-contents__link toc-highlight">texts.xsd中的字体大小限制</a></li><li><a href="#sdl2-linker-error-on-linux" class="table-of-contents__link toc-highlight">Linux上的SDL2链接器错误</a></li></ul></li><li><a href="#touchgfx-4-17-0" class="table-of-contents__link toc-highlight">TouchGFX 4.17.0</a><ul><li><a href="#painters-no-longer-support-setalpha" class="table-of-contents__link toc-highlight">绘图工具不再支持setAlpha()</a></li><li><a href="#using-the-hal-class" class="table-of-contents__link toc-highlight">使用HAL类</a></li><li><a href="#fmc-display-interface-in-touchgfx-generator" class="table-of-contents__link toc-highlight">TouchGFX Generator中的FMC显示接口</a></li><li><a href="#l8-images-in-16-24-or-32bpp-configurations" class="table-of-contents__link toc-highlight">16-24或32bpp配置的L8图像</a></li></ul></li><li><a href="#touchgfx-4150" class="table-of-contents__link toc-highlight">TouchGFX 4.15.0</a><ul><li><a href="#mcu-support" class="table-of-contents__link toc-highlight">支持的MCU</a></li></ul></li><li><a href="#touchgfx-4140" class="table-of-contents__link toc-highlight">TouchGFX 4.14.0</a><ul><li><a href="#armclang-support" class="table-of-contents__link toc-highlight">ARMCLANG支持</a></li></ul></li><li><a href="#touchgfx-4130" class="table-of-contents__link toc-highlight">TouchGFX 4.13.0</a><ul><li><a href="#bugs" class="table-of-contents__link toc-highlight">错误</a></li><li><a href="#additional-compiler-support" class="table-of-contents__link toc-highlight">额外编译器支持</a></li><li><a href="#backwards-compatibility" class="table-of-contents__link toc-highlight">向后兼容</a></li></ul></li><li><a href="#touchgfx-4123" class="table-of-contents__link toc-highlight">TouchGFX 4.12.3</a><ul><li><a href="#backwards-compatibility-1" class="table-of-contents__link toc-highlight">向后兼容</a></li></ul></li><li><a href="#touchgfx-4110" class="table-of-contents__link toc-highlight">TouchGFX 4.11.0</a><ul><li><a href="#backwards-compatibility-2" class="table-of-contents__link toc-highlight">向后兼容</a></li></ul></li><li><a href="#touchgfx-4100" class="table-of-contents__link toc-highlight">TouchGFX 4.10.0</a><ul><li><a href="#upgrading-from-49x" class="table-of-contents__link toc-highlight">从4.9.x升级</a></li><li><a href="#backwards-compatibility-3" class="table-of-contents__link toc-highlight">向后兼容</a></li><li><a href="#project-updater-issue" class="table-of-contents__link toc-highlight">工程更新器的问题</a></li><li><a href="#textarea-and-chromart-dma2d" class="table-of-contents__link toc-highlight">TextArea和ChromART（DMA2D）</a></li></ul></li><li><a href="#touchgfx-490" class="table-of-contents__link toc-highlight">TouchGFX 4.9.0</a><ul><li><a href="#upgrading-from-480" class="table-of-contents__link toc-highlight">从4.8.0升级</a></li><li><a href="#method-1-retain-original-file-structure" class="table-of-contents__link toc-highlight">方法1：保留原始文件结构</a></li><li><a href="#method-2-import-into-new-template" class="table-of-contents__link toc-highlight">方法2：导入到新的模板</a></li><li><a href="#method-3-manual-upgrade-without-designer" class="table-of-contents__link toc-highlight">方法3：手工升级（无TouchGFX Designer）</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2022 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">Terms of use</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">Privacy Policy</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie Policy</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">Exercise your rights</a></div></div></div></footer></div></div>
<script src="/4.21/zh-CN/assets/js/runtime~main.1202490c.js"></script>
<script src="/4.21/zh-CN/assets/js/main.8eee2a9c.js"></script>
</body>
</html>