<!doctype html>
<html lang="zh-TW" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-basic-concepts/rendering">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.21/zh-TW/opensearch.xml">
<script src="/4.21/zh-TW/js/one-trust.js"></script>
<script src="/4.21/js/fix-location.js"></script><title data-rh="true">主迴圈 | TouchGFX Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://support.touchgfx.com/4.21/zh-TW/img/meta-image.png"><meta data-rh="true" name="twitter:image" content="https://support.touchgfx.com/4.21/zh-TW/img/meta-image.png"><meta data-rh="true" property="og:url" content="https://support.touchgfx.com/4.21/zh-TW/docs/basic-concepts/rendering"><meta data-rh="true" name="docusaurus_locale" content="zh-TW"><meta data-rh="true" name="docsearch:language" content="zh-TW"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="主迴圈 | TouchGFX Documentation"><link data-rh="true" rel="icon" href="/4.21/zh-TW/img/favicon.png"><link data-rh="true" rel="canonical" href="https://support.touchgfx.com/4.21/zh-TW/docs/basic-concepts/rendering"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/basic-concepts/rendering" hreflang="en"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ko/docs/basic-concepts/rendering" hreflang="ko"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ja/docs/basic-concepts/rendering" hreflang="ja"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-CN/docs/basic-concepts/rendering" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-TW/docs/basic-concepts/rendering" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/basic-concepts/rendering" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.21/zh-TW/assets/css/styles.a3789d89.css">
<link rel="preload" href="/4.21/zh-TW/assets/js/runtime~main.a3a7aa3c.js" as="script">
<link rel="preload" href="/4.21/zh-TW/assets/js/main.0fa00216.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><div role="region"><a href="#" class="skipToContent_fXgn">跳轉到主要內容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.21/zh-TW/docs/introduction/welcome"><div class="navbar__logo"><img src="/4.21/zh-TW/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--light_HNdA"><img src="/4.21/zh-TW/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">繁體中文</a><ul class="dropdown__menu"><li><a href="/4.21/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/4.21/ko/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li><li><a href="/4.21/ja/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/4.21/zh-CN/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">简体中文</a></li><li><a href="/4.21/zh-TW/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/4.21/zh-TW/docs/introduction/welcome">4.21</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.21/zh-TW/docs/basic-concepts/rendering">4.21</a></li><li><a href="https://support.touchgfx.com/4.20" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.20<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.19" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.19<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.18" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.18<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.17" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.17<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.16" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.16<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">社區</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_ZlJk"><div class="searchBox_Gz_y"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="滾動返回頂部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/zh-TW/docs/category/introduction">介紹</a><button aria-label="切換可折疊邊欄類別“介紹”" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/4.21/zh-TW/docs/category/basic-concepts">基本概念</a><button aria-label="切換可折疊邊欄類別“基本概念”" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/zh-TW/docs/basic-concepts/embedded-graphics">嵌入式繪圖系統</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/zh-TW/docs/basic-concepts/color-formats">色彩格式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/zh-TW/docs/basic-concepts/framebuffer">影像緩衝區</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/zh-TW/docs/basic-concepts/graphics-engine">圖形引擎</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.21/zh-TW/docs/basic-concepts/rendering">主迴圈</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/zh-TW/docs/basic-concepts/performance">性能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/zh-TW/docs/basic-concepts/operating-system">作業系統</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/zh-TW/docs/basic-concepts/memory-usage">記憶體使用</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/zh-TW/docs/development/development-introduction">開發</a><button aria-label="切換可折疊邊欄類別“開發”" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/zh-TW/docs/category/miscellaneous-1">其他情況</a><button aria-label="切換可折疊邊欄類別“其他情況”" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/zh-TW/docs/category/tutorials">指導</a><button aria-label="切換可折疊邊欄類別“指導”" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.21/zh-TW/docs/api/classes/classtouchgfx_1_1_abstract_button">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/zh-TW/docs/category/resources">資源</a><button aria-label="切換可折疊邊欄類別“資源”" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/4.21/zh-TW/docs/category/basic-concepts"><span itemprop="name">基本概念</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">主迴圈</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">在當前頁面</button></div><div class="theme-doc-markdown markdown"><header><h1>主迴圈</h1></header><p>在本節中，您將學習更多關於TouchGFX中圖形引擎的工作方式特別是主迴圈的內容。 回想一下，圖形引擎的主要任務是將應用的圖形（ui模型）渲染到影像緩衝。 此過程反復發生，以便在顯示器上產生新的影像。</p><div class="figure noshadow"><a href="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle.webp" target="_blank"><img width="320" src="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle.webp"></a><p></p></div><p>圖形引擎<em>採集</em>外部事件，例如顯示器觸摸或按鈕按下事件。 這些事件經過篩選後被傳遞到應用。 應用可使用這些事件更新UI模型。 例如 在使用者觸控螢幕上的按鈕時將按鈕狀態更改為按下狀態，然後在使用者不再觸控螢幕時將按鈕狀態改回釋放狀態。</p><p>最後，圖形引擎將更新後的模型渲染到影像緩衝。 此過程無限輪迴。</p><p>在渲染影像後，影像緩衝被傳輸到顯示器，用戶可從顯示器上看到圖形。 為避免顯示器上的短時脈衝波干擾，傳輸過程必須與顯示器同步。 對於某些顯示器，必須以最小時間間隔定期進行傳輸。 對於其餘顯示器，必須在顯示器發出信號時進行傳輸。</p><p>圖形引擎通過等待硬體抽象層發出的“開始”信號實現此同步。 點擊<a href="/4.21/zh-TW/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction">此</a>處閱讀關於硬體抽象層的更多內容</p><p>在程式碼中，TouchGFX圖形引擎內部的主迴圈大致是這樣的：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">collect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Collect events from outside</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Update the application ui model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Render new updated graphics to the framebuffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">wait</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Wait for &#x27;go&#x27; from display</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>程式碼更多地涉及實際實現，但上述程式碼有助於理解引擎的主要部分。</p><p>下面我們將詳細討論這四個階段。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="collect">採集<a class="hash-link" href="#collect" title="直接連結到標題">​</a></h2><p>在該階段，圖形引擎從外部環境採集事件。 這些事件通常是觸摸事件和按鈕。</p><p>TouchGFX對事件進行採樣並傳遞到應用。 原始觸摸事件會被轉換為更具體的觸摸事件：</p><ul><li><strong>點擊：</strong>使用者用手指在螢幕上按下或鬆開</li><li><strong>拖曳：</strong>使用者在螢幕上移動其手指（在觸控式螢幕的同時）。</li><li><strong>手勢：</strong>用戶沿某個方向快速移動其手指然後釋放。 這被稱為<em>滑動</em>，由圖形引擎識別。</li></ul><p>事件被傳遞到當前活動的UI元素（如小工具）。</p><p>引擎還傳遞<em>tick</em>事件。 此事件表示新的幀（或時間節拍），會一直發送，在沒有其他外部輸入時也會發送。 應用使用此事件驅動動畫或其他基於時間的操作，例如在特定時間結束後切換到暫停介面。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="update">更新<a class="hash-link" href="#update" title="直接連結到標題">​</a></h2><p>圖形引擎與應用一起更新UI，以便反映採集的事件。 圖形引擎知曉當前活動的介面，並將事件傳遞給該物件。</p><p>基本原理是引擎將事件通知給應用（即UI模型中的Screen和Widget物件）。 作為回應，應用請求重繪介面的特定部分。 應用不以直接繪製的方式回應事件，而是更改小工具的屬性並請求重繪。</p><p>如果發生諸如Click這樣的事件，圖形引擎將搜索Screen物件的場景模型，以便找到應接收事件的小工具（觸控點下方的最頂層小工具）。 一些Widget（如Image和TextArea）不希望接收Click事件，因此被忽略。 它們有一個空事件處理函式。</p><p>其他Widget（如Button）會回應Click事件（按下或釋放）。 例如，Button小工具在被按下時更改其狀態並顯示另一幅圖像，並在觸摸再次釋放時變回原始狀態。</p><div class="figure noshadow"><a href="/4.21/zh-TW/img/basic-concepts/rendering/button-on-image.webp" target="_blank"><img width="480" src="/4.21/zh-TW/img/basic-concepts/rendering/button-on-image.webp"></a><p>背景中前方有Button小工具的Image小工具</p></div><p>當Widget（如Button）改變其狀態時，也必須在影像緩衝中重繪它。 作為對事件的回應，Widget負責將此資訊傳回圖形引擎。 圖形引擎本身不基於採集的事件重繪任何小工具。 小工具持續跟蹤自身的內部狀態（對於Button，為要繪製的圖像），並指示圖形引擎重繪小工具覆蓋的介面部分（矩形）。</p><p>應用本身也能對事件做出回應。 通常使用以下兩種方式中的一種：</p><ul><li><strong>在TouchGFX Designer中為Widget配置<a href="/4.21/zh-TW/docs/development/ui-development/designer-user-guide/interactions-view">交互</a></strong> 例如，我們可以配置交互，讓另一個Widget在Button被按下時可見。 此交互在Button更改其狀態並從圖形引擎請求重繪自身之後執行。 如果使用此交互顯示另一個（不可見）Widget，應用還應從圖形引擎請求重繪。</li><li><strong>在介面上回應事件</strong> 也可以直接在介面上回應事件。 事件處理器是Screen類上的虛擬函數（見下方清單）。 這些函數可在應用的Screen中重複實現。 例如，可用於在用戶觸控式螢幕時執行操作（無論哪裡，只要觸摸的是小工具）。</li></ul><p>Screen類具有下列事件處理器。 在採集到相應外部事件後，圖形引擎會呼叫這些函數：</p><div class="code-header"><div><h5>framework/include/touchgfx/Screen.hpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleClickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> ClickEvent</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleDragEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> DragEvent</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleGestureEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> GestureEvent</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleKeyEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以在這些事件處理器中插入任何C++程式碼。 應用通常會更新一些Widget的狀態和/或呼叫一些應用特定的函數。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="time-based-updates">基於時間的更新<a class="hash-link" href="#time-based-updates" title="直接連結到標題">​</a></h3><p>handleTickEvent事件處理器在每一幀都會被呼叫。 這使得應用能夠基於時間更新使用者介面。 例如，在10秒後Widget漸隱。 假設我們在一秒鐘內有60幀（10秒就是600幀），程式碼可能如下所示：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Screen1ViewBase</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Call superclass eventhandler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">600</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        myWidget</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">startFadeAnimation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Fade to 0 = invisible in 20 frames</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>圖形引擎還將呼叫Model類上的事件處理器。 此事件處理器通常用於執行重複操作，如檢查訊息佇列或進行GPIO採樣：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Model</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">tick</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sampleGPIO_Input1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Sample polled IO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>只有當特定Screen子類是活動屏時，才會呼叫該螢幕上的事件處理常式。 始終呼叫Model類上的事件處理函式（與活動Screen無關）。 從而使得模型事件處理常式適合“應用程式範圍”邏輯。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requesting-a-redraw">請求重繪<a class="hash-link" href="#requesting-a-redraw" title="直接連結到標題">​</a></h3><p>正如上文所述，以Button為例，Widget負責在其狀態改變時請求重繪。 這背後的機制稱為<em>無效區域</em>。</p><p>當Button改變狀態（如從釋放變為按下）並需要重繪時，Button Widget覆蓋的區域即為無效區域。 圖形引擎保留了為幀請求的這些無效區域的清單。 採集的所有事件（觸摸、按鈕和tick）可能導致一個或多個無效區域，因此每一幀可能有許多個無效區域。</p><p>Screen類上的事件處理器也可以請求區域重繪。 下面我們更改第10幀的Box小工具box1的色彩，並通過呼叫Box上的<em>Invalidate</em>方法請求重繪：</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Screen1ViewBase</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">                          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Call superclass eventhandler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        box1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setColor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Color</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getColorFromRGB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0xFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Set color to red</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        box1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">invalidate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">                                       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Request redraw</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="複製程式碼到剪貼板" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在本例中，圖形引擎將在每一幀中呼叫<em>handleTickEvent</em>處理器。 在第10幀，應用程式碼請求重繪<em>box1</em>覆蓋的區域。 作為對該請求的回應，圖形引擎將在影像緩衝中用<em>box1</em>小工具中保存的色彩重繪該區域。</p><p>在下面的使用者介面中，背景圖像上方有一個Button Widget和一個Box Widget。 如果我們在Button上插入一個交互，以便在Button被點擊時更改Box的色彩，那麼當用戶點擊Button時，我們會得到兩個無效區域（用紅色表示）：</p><div class="figure noshadow"><a href="/4.21/zh-TW/img/basic-concepts/rendering/button-and-box.webp" target="_blank"><img width="480" src="/4.21/zh-TW/img/basic-concepts/rendering/button-and-box.webp"></a><p>兩個無效區域</p></div><p>為了獲得影像緩衝中繪製的新色彩，Box的區域無效化。 為了重新繪製釋放狀態，Button還將自身無效化。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="render">渲染<a class="hash-link" href="#render" title="直接連結到標題">​</a></h2><p>如前文所述，更新階段的結果是待重繪區域（無效區域）的清單。 渲染階段的任務實際上是遍歷此列表，並將覆蓋這些區域的Widget繪製到影像緩衝。</p><p>此階段由圖形引擎自動處理。 應用已經定義的場景模型（ui中的Widget）並使一些區域無效化。 其餘的工作由引擎來處理。</p><p>圖形引擎逐一處理無效區域。 引擎掃描每個區域的場景模型，並採集區域覆蓋（部分或全部）的Widget的清單。</p><p>根據此Widget清單，圖形引擎呼叫Widget上的繪製方法。 從背景中的Widget開始，到最前面的Widget結束。</p><p>在繪製到影像緩衝時，Widget的繪製方法會用到Widget的狀態（如色彩）。 在更新階段，繪製Widget所需的任何資訊都必須保存到Widget。 否則，在渲染階段將無法獲取此資訊。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="wait">Wait<a class="hash-link" href="#wait" title="直接連結到標題">​</a></h2><p>TouchGFX圖形引擎在更新和渲染下一幀之前等待一個信號。 之所以在幀之間等待而不是儘快地繼續渲染幀，原因有兩個：</p><ul><li><p>渲染與顯示器同步。 如上文所述，一些顯示器需要反復發送影像緩衝。 在發送進行時，隨意地將幀渲染到影像緩衝是不可取的。 因此，圖形引擎會在發送開始後等待一小段時間，然後再開始渲染。 在應發送影像緩衝時，其他顯示器向微控制器發送信號。 圖形引擎等待該信號。</p></li><li><p>按固定速率渲染幀。 對於應用而言，按固定速率渲染影像的好處是更容易創建持續特定時間的動畫。 例如，如果顯示器頻率為60 Hz，則應將兩秒鐘的動畫設定為在120幀內完成。</p></li></ul><p>圖形引擎的等待時間通常被應用中其他優先順序較低的程序利用。 在這種情況下，時間不會被浪費，優先順序較低的程序反正都應在某些時間點運行。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="handling-the-framebuffers">處理影像緩衝<a class="hash-link" href="#handling-the-framebuffers" title="直接連結到標題">​</a></h2><p>如前文所述，圖形引擎會在更新影像緩衝之前與顯示器同步。 在渲染到影像緩衝後，引擎還需確保顯示器顯示更新後的影像緩衝。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="two-framebuffers">兩個影像緩衝<a class="hash-link" href="#two-framebuffers" title="直接連結到標題">​</a></h3><p>在最簡單的設置中，有兩個影像緩衝可供使用。 圖形引擎在兩個影像緩衝之間切換。 在將影像繪製到一個影像緩衝的同時，將另一個影像緩衝傳輸到（並顯示在）顯示器上。</p><div class="figure noshadow"><a href="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle-2fb-normal.webp" target="_blank"><img src="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle-2fb-normal.webp"></a><p>雙影像緩衝</p></div><p>在此次繪製中，假設並行RGB顯示器連接了LTDC控制器。 這意味著在每一幀中都必須將影像緩衝發送到顯示器。 由於有兩個影像緩衝，圖形引擎可以在發送一個影像緩衝的同時將影像繪製到另一個影像緩衝。 此方案效果很好，如可能，應作為首選方案。</p><p>由於圖形引擎在每一幀都進行繪製，在上面的繪製中，我們也在所有影像發送新的影像緩衝。</p><p>常常會有應用不更新任何內容的幀。 這表示不進行任何渲染。 因此，在下一幀會再次發送相同的影像緩衝。</p><div class="figure noshadow"><a href="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle-2fb-no-update.webp" target="_blank"><img src="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle-2fb-no-update.webp"></a><p>2號幀中無更新</p></div><p>應用在2號幀未繪製任何內容，因此圖形引擎在3號幀再次重發2號幀緩衝。</p><p>典型的平行RGB顯示器的刷新率約為60 Hz。 此更新頻率必須由微控制器來維護。 此更新頻率意味著在再次開始發送前，有16 ms的時間可用來渲染新幀。 在某些情況下，渲染新幀的時間超過16 ms。 此時，圖形引擎只再次重發相同的幀（同之前一樣）：</p><div class="figure noshadow"><a href="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle-2fb-long-render.webp" target="_blank"><img src="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle-2fb-long-render.webp"></a><p>渲染時間長</p></div><p>1號幀的渲染時間超過16 ms，因此重發之前渲染到1號影像緩衝的0號幀。 在3號幀發送2號影像緩衝中的新幀。 當有兩個影像緩衝可供使用時，渲染時間可能會非常長。 在有新幀可用之前，會一直重發上一幀。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="one-framebuffer">一個影像緩衝<a class="hash-link" href="#one-framebuffer" title="直接連結到標題">​</a></h3><p>在某些系統中，只有一個影像緩衝的存儲空間。 如果使用平行RGB顯示器，則必須在每一幀發送1號影像緩衝。</p><p>由於圖形引擎不得不在向顯示器發送影像緩衝的同時將影像繪製到同一個影像緩衝，因此會產生問題。 如果不加注意就這樣做，會有一個極大的風險，即顯示器會顯示上一影像與新影像的混合影像。</p><p>一種解決方案是在傳輸完成前不進行繪製，只在傳輸再次開始前的時間間隙內繪製。 由於傳輸佔用了整個影像時間的很大一部分，因此可用於繪製影像的時間極少。 另一個缺點是如果在下一次傳輸開始時繪製未完成，則仍可能出現不完整的影像（撕裂）。</p><p>一種更有潛力的解決方案是監測影像緩衝已發送的量，然後將渲染次數限制在影像緩衝的合適範圍內。 雖然傳輸的進行，影像緩衝有越來越多的部分可供渲染演算法使用。</p><p>圖形引擎包含協助工程師確保繪製正確執行的演算法。</p><p>應用在每一幀更新並渲染影像緩衝：</p><div class="figure noshadow"><a href="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle-1fb-normal.webp" target="_blank"><img src="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle-1fb-normal.webp"></a><p>在每一幀重發一個影像緩衝</p></div><p>如果幀沒有更新任何內容，則重發影像緩衝，不做任何更改。</p><p>如果渲染時間超過16 ms，當再次開始重發時，渲染尚未結束：</p><div class="figure noshadow"><a href="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle-1fb-long-render.webp" target="_blank"><img src="/4.21/zh-TW/img/basic-concepts/rendering/engine-cycle-1fb-long-render.webp"></a><p>渲染時間長</p></div><p>在這種情況下，圖形引擎必須確保正在發送的部分已完成渲染。 否則，顯示器將顯示未完成的影像緩衝。</p><p>在下一節中，我們將討論各個Widget的渲染時間。 這將有助於工程師開發出高性能的應用。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件頁面導航"><a class="pagination-nav__link pagination-nav__link--prev" href="/4.21/zh-TW/docs/basic-concepts/graphics-engine"><div class="pagination-nav__sublabel">上一個</div><div class="pagination-nav__label">圖形引擎</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/4.21/zh-TW/docs/basic-concepts/performance"><div class="pagination-nav__sublabel">下一個</div><div class="pagination-nav__label">性能</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#collect" class="table-of-contents__link toc-highlight">採集</a></li><li><a href="#update" class="table-of-contents__link toc-highlight">更新</a><ul><li><a href="#time-based-updates" class="table-of-contents__link toc-highlight">基於時間的更新</a></li><li><a href="#requesting-a-redraw" class="table-of-contents__link toc-highlight">請求重繪</a></li></ul></li><li><a href="#render" class="table-of-contents__link toc-highlight">渲染</a></li><li><a href="#wait" class="table-of-contents__link toc-highlight">Wait</a></li><li><a href="#handling-the-framebuffers" class="table-of-contents__link toc-highlight">處理影像緩衝</a><ul><li><a href="#two-framebuffers" class="table-of-contents__link toc-highlight">兩個影像緩衝</a></li><li><a href="#one-framebuffer" class="table-of-contents__link toc-highlight">一個影像緩衝</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">保留所有權利 © 2022 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">使用條款</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">隱私權原則</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie政策</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">行使您的權利</a></div></div></div></footer></div></div>
<script src="/4.21/zh-TW/assets/js/runtime~main.a3a7aa3c.js"></script>
<script src="/4.21/zh-TW/assets/js/main.0fa00216.js"></script>
</body>
</html>