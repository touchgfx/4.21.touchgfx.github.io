<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-basic-concepts/rendering">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.21/ja/opensearch.xml">
<script src="/4.21/ja/js/one-trust.js"></script>
<link rel="icon" href="/4.21/ja/img/icons/icon-192x192.png">
<link rel="manifest" href="/4.21/ja/manifest.json">
<meta name="theme-color" content="rgb(21, 142, 194)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/4.21/ja/img/icons/icon-192x192.png">
<link rel="mask-icon" href="/4.21/ja/img/icon.svg" color="rgb(21, 142, 194)">
<meta name="msapplication-TileImage" content="/4.21/ja/img/icons/icon-192x192.png">
<meta name="msapplication-TileColor" content="#000">
<script src="/4.21/js/fix-location.js"></script><title data-rh="true">メイン･ループ | TouchGFX Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://support.touchgfx.com/4.21/ja/img/meta-image.png"><meta data-rh="true" name="twitter:image" content="https://support.touchgfx.com/4.21/ja/img/meta-image.png"><meta data-rh="true" property="og:url" content="https://support.touchgfx.com/4.21/ja/docs/basic-concepts/rendering"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="メイン･ループ | TouchGFX Documentation"><link data-rh="true" rel="icon" href="/4.21/ja/img/favicon.png"><link data-rh="true" rel="canonical" href="https://support.touchgfx.com/4.21/ja/docs/basic-concepts/rendering"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/basic-concepts/rendering" hreflang="en"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ko/docs/basic-concepts/rendering" hreflang="ko"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ja/docs/basic-concepts/rendering" hreflang="ja"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-CN/docs/basic-concepts/rendering" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-TW/docs/basic-concepts/rendering" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/basic-concepts/rendering" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.21/ja/assets/css/styles.56327e77.css">
<link rel="preload" href="/4.21/ja/assets/js/runtime~main.cad63f94.js" as="script">
<link rel="preload" href="/4.21/ja/assets/js/main.865d9041.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><div role="region"><a href="#" class="skipToContent_fXgn">メイン･コンテンツまでスキップ</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.21/ja/docs/introduction/welcome"><div class="navbar__logo"><img src="/4.21/ja/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--light_HNdA"><img src="/4.21/ja/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">日本語</a><ul class="dropdown__menu"><li><a href="/4.21/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/4.21/ko/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li><li><a href="/4.21/ja/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">日本語</a></li><li><a href="/4.21/zh-CN/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">简体中文</a></li><li><a href="/4.21/zh-TW/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/4.21/ja/docs/introduction/welcome">4.21</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.21/ja/docs/basic-concepts/rendering">4.21</a></li><li><a href="https://support.touchgfx.com/4.20" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.20<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.19" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.19<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.18" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.18<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.17" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.17<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.16" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.16<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">コミュニティ</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="検索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">検索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="上へスクロールしてもどる" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/ja/docs/category/introduction">概要</a><button aria-label="折りたたみ可能なサイドバーのカテゴリ&#x27;概要&#x27;を切り替える" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/4.21/ja/docs/category/basic-concepts">基本概念</a><button aria-label="折りたたみ可能なサイドバーのカテゴリ&#x27;基本概念&#x27;を切り替える" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/ja/docs/basic-concepts/embedded-graphics">組込みグラフィックス</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/ja/docs/basic-concepts/color-formats">カラーフォーマット</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/ja/docs/basic-concepts/framebuffer">フレームバッファ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/ja/docs/basic-concepts/graphics-engine">グラフィック･エンジン</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.21/ja/docs/basic-concepts/rendering">メイン･ループ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/ja/docs/basic-concepts/performance">パフォーマンス</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/ja/docs/basic-concepts/operating-system">オペレーティング･システム</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/ja/docs/basic-concepts/memory-usage">メモリ使用量</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/ja/docs/development/development-introduction">開発</a><button aria-label="折りたたみ可能なサイドバーのカテゴリ&#x27;開発&#x27;を切り替える" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/ja/docs/category/miscellaneous-1">その他</a><button aria-label="折りたたみ可能なサイドバーのカテゴリ&#x27;その他&#x27;を切り替える" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/ja/docs/category/tutorials">チュートリアル</a><button aria-label="折りたたみ可能なサイドバーのカテゴリ&#x27;チュートリアル&#x27;を切り替える" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.21/ja/docs/api/classes/classtouchgfx_1_1_abstract_button">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/ja/docs/category/resources">リソース</a><button aria-label="折りたたみ可能なサイドバーのカテゴリ&#x27;リソース&#x27;を切り替える" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div id="doc-version-banner-identifier" class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>TouchGFX Documentation<!-- --> <b>4.21</b>のドキュメントですが、これはアクティブに保持されていません。</div><div class="margin-top--md">ドキュメントの最新版については、<b><a href="https://support.touchgfx.com/docs/basic-concepts/rendering" target="_blank" rel="noopener noreferrer">最新版</a></b>を参照してください。</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリスト"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/4.21/ja/docs/category/basic-concepts"><span itemprop="name">基本概念</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">メイン･ループ</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページでは</button></div><div class="theme-doc-markdown markdown"><header><h1>メイン･ループ</h1></header><p>このセクションでは、TouchGFXのグラフィック･エンジンの動作、特にメイン･ループの働きについてさらに説明します。 復習になりますが、グラフィック･エンジンの主なタスクは、アプリケーションのグラフィックス（UIモデル）をフレームバッファに描画することでした。 このプロセスが何度も繰り返され、画面上に新しいフレームが作成されます。</p><div class="figure noshadow"><a href="/4.21/ja/img/basic-concepts/rendering/engine-cycle.webp" target="_blank"><img width="320" src="/4.21/ja/img/basic-concepts/rendering/engine-cycle.webp"></a><p></p></div><p>グラフィック･エンジンは、画面タッチやボタン押下などの外部イベントを<em>収集</em>します。 これらのイベントはフィルタ処理され、アプリケーションに送られます。 アプリケーションはこれらのイベントを使用して、UIモデルを更新します。 たとえば、 ユーザがスクリーンのボタン上をタッチしたときにボタンを押下状態に変更し、その後、ユーザがスクリーンをそれ以上タッチしなければ、ボタンを元の解放状態に戻すといった動作です。</p><p>最終的に、グラフィック･エンジンは更新されたモデルをフレームバッファに描画します。 このプロセスは永遠にループします。</p><p>フレームを描画した後、フレームバッファはディスプレイに転送され、そこでユーザはグラフィックスを目にすることができます。 ディスプレイ上の目障りなグリッチを防ぐために、ディスプレイへの転送はディスプレイと同期する必要があります。 一部のディスプレイでは、最小限の間隔で定期的に転送する必要があります。 その他のディスプレイでは、ディスプレイから信号が送信されたときに、転送することが必要になります。</p><p>グラフィック･エンジンは、ハードウェア抽象化レイヤからの&quot;go&quot;信号を待つことで、この同期化を実行します。 ハードウェア抽象化レイヤの詳細については、<a href="/4.21/ja/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction">こちら</a>を参照してください。</p><p>疑似コードでは、TouchGFXグラフィック･エンジン内部のメイン･ループは次のようになります。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">collect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Collect events from outside</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Update the application ui model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Render new updated graphics to the framebuffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">wait</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Wait for &#x27;go&#x27; from display</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="コードをクリップボードにコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>実際の実装ではコードがさらに深く関与しますが、上記の疑似コードはエンジンの主要部分の理解に役立ちます。</p><p>ここに示された4つのステージについて、以下に詳しく説明します。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="collect">Collect（収集）<a class="hash-link" href="#collect" title="見出しに直接リンク">​</a></h2><p>このフェーズでは、グラフィック･エンジンは外部環境からイベントを収集します。 これらのイベントは、通常はタッチ･イベントとボタンです。</p><p>TouchGFXはイベントをサンプリングし、アプリケーションに伝えます。 元のタッチ･イベントは、以下に示すより具体的なタッチ･イベントに変換されます。</p><ul><li><strong>クリック:</strong> ユーザがディスプレイを指で押すか、ディスプレイから指を離しました。</li><li><strong>ドラッグ:</strong> ユーザが（ディスプレイにタッチしたまま）ディスプレイ上で指を動かしました。</li><li><strong>ジェスチャ:</strong> ユーザが一方向に指をすばやく動かして離しました。 これはスワイプと呼ばれ、グラフィック･エンジンによって認識されます。</li></ul><p>イベントは、現在アクティブなUI要素（ウィジェットなど）に送られます。</p><p>エンジンはティック･イベントも送ります。 このイベントは新しいフレーム（または時間のステップ）を表し、他に外部入力がない場合でも、常に送信されます。 このイベントは、アプリケーションによって、アニメーションやその他のタイムベースのアクション（一定時間経過した後に、一時停止画面への変更など）の駆動に使用されます。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="update">Update（更新）<a class="hash-link" href="#update" title="見出しに直接リンク">​</a></h2><p>次に、グラフィック･エンジンがアプリケーションと連携して、収集したイベントを反映するようにUIを更新します。 グラフィック･エンジンは、現在アクティブなスクリーンを認知し、このオブジェクトにイベントを渡します。</p><p>基本原理として、エンジンがアプリケーション（UIモデルのスクリーンおよびウィジェット･オブジェクト）にイベントに関する情報を知らせます。 それに反応して、アプリケーションがディスプレイの特定部分の再描画を要求します。 アプリケーションは、イベントに反応して直接描画するのではなく、ウィジェットのプロパティを変更し、ウィジェットの再描画を要求します。</p><p>たとえば、Clickイベントが発生した場合、グラフィック･エンジンはスクリーン･オブジェクトのシーン･モデルを検索して、イベントを受け取るべきウィジェットを見つけます（タッチ･ポイントの下の一番上のウィジェット）。 ImageやTextAreaなどの一部のウィジェットは、Clickイベントを受け取る必要がないので無視されます。 これらには空のイベント･ハンドラもあります。</p><p>Buttonなどの他のウィジェットは、Clickイベント（押下または解放）に反応します。 たとえば、Buttonウィジェットは、押下されると別の画像を表示するように状態を変更し、タッチが解放されて元に戻ると、状態を元に戻します。</p><div class="figure noshadow"><a href="/4.21/ja/img/basic-concepts/rendering/button-on-image.webp" target="_blank"><img width="480" src="/4.21/ja/img/basic-concepts/rendering/button-on-image.webp"></a><p>バックグラウンドのImageウィジェットと前面のButtonウィジェット</p></div><p>Buttonなどのウィジェットがその状態を変更した場合には、フレームバッファの再描画も必要になります。 ウィジェットは、イベントに反応して、このことをグラフィック･エンジンに伝える役割を担っています。 グラフィック･エンジンそのものが、収集したイベントに基づいてウィジェットを再描画するわけではありません。 ウィジェットは自身の内部状態（Buttonであれば、描画すべき画像）を追跡し、そのウィジェットがカバーするディスプレイ上の部分（長方形）の再描画を、グラフィック･エンジンに指示します。</p><p>アプリケーションそのものが、イベントに反応することもできます。 一般的に、次の2つの方法のいずれかが使用されます。</p><ul><li><strong>TouchGFX Designerでウィジェットの<a href="/4.21/ja/docs/development/ui-development/designer-user-guide/interactions-view">インタラクション</a>を設定:</strong> たとえば、Buttonが押されたときに別のウィジェットが表示されるように、インタラクションを設定できます。 このインタラクションは、Buttonが状態を変更し、Buttonそのものの再描画をグラフィック･エンジンから要求された後に実行されます。 インタラクションを使用して別の（非表示の）ウィジェットを表示する場合、アプリケーションもグラフィック･エンジンからの再描画を要求する必要があります。</li><li><strong>スクリーン上でのイベントへの反応:</strong> スクリーンそのものでイベントに反応することもできます。 イベント･ハンドラはScreenクラスの仮想関数です（下のリストを参照）。 これらの関数は、アプリケーションのScreens内に再実装できます。 これは、ユーザがスクリーンにタッチしたときに、（タッチがウィジェット上であれば場所に関係なく）常にアクションを実行するような場合に使用できます。</li></ul><p>Screenクラスには以下のイベント･ハンドラがあります。 これらは、対応する外部イベントが収集されたときに、グラフィック･エンジンによって呼び出されます。</p><div class="code-header"><div><h5>framework/include/touchgfx/Screen.hpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleClickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> ClickEvent</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleDragEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> DragEvent</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleGestureEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> GestureEvent</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleKeyEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="コードをクリップボードにコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>これらのイベント･ハンドラには、任意のC++コードを挿入できます。 通常は、アプリケーションが一部のウィジェットの状態を更新するか、一部のアプリケーション固有の関数（ビジネス･ロジック）を呼び出します。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="time-based-updates">タイムベース更新<a class="hash-link" href="#time-based-updates" title="見出しに直接リンク">​</a></h3><p>handleTickEventイベント･ハンドラは、すべてのフレームごとに呼び出されます。 これにより、アプリケーションはユーザ･インタフェースのタイムベース更新を実行できます。 例として、10秒後にウィジェットが消えていくようにすることが考えられます。 1秒に60フレームある（つまり10秒で600ティックである）とすると、コードは以下のようになります。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Screen1ViewBase</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Call superclass eventhandler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">600</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        myWidget</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">startFadeAnimation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Fade to 0 = invisible in 20 frames</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="コードをクリップボードにコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>グラフィック･エンジンは、Modelクラスでもイベント･ハンドラを呼び出します。 通常、このイベント･ハンドラは、メッセージ･キューの確認やGPIOのサンプリングといった繰り返しのアクションを実行するために使用されます。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Model</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">tick</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sampleGPIO_Input1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Sample polled IO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="コードをクリップボードにコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>特定のScreenサブクラス上のイベントハンドラは、そのスクリーンがアクティブなスクリーンである場合のみ呼び出されます。 Modelクラス上のイベントハンドラは（アクティブなスクリーンがどれかに関係なく）常に呼び出されます。 このため、Modelのイベントハンドラは&quot;アプリケーション規模の&quot;ロジックに適しています。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requesting-a-redraw">再描画の要求<a class="hash-link" href="#requesting-a-redraw" title="見出しに直接リンク">​</a></h3><p>上のButtonの例で説明したように、ウィジェットは状態を変更するときに再描画を要求する役割を担います。 この背後にあるメカニズムは無効化領域と呼ばれます。</p><p>Buttonが（たとえば解放から押下へ）状態を変更し、再描画が必要になった場合、Buttonウィジェットがカバーする領域は無効化領域になります。 グラフィック･エンジンは、フレームに対して要求されるこれらの無効化領域のリストを保持しています。 収集されたイベント（タッチ、ボタン、ティック）のすべてにおいて、1つ以上の無効化領域が生成される可能性があるので、フレームごとに多数の無効化領域が存在することになります。</p><p>Screenクラスのイベント･ハンドラも領域の再描画を要求できます。 ここでは、フレーム10のBoxウィジェット（box1）の色を変更し、Boxでinvalidateメソッドを呼び出すことで再描画を要求します。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Screen1ViewBase</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">                          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Call superclass eventhandler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        box1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setColor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Color</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getColorFromRGB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0xFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Set color to red</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        box1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">invalidate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">                                       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Request redraw</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="コードをクリップボードにコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>この例では、グラフィック･エンジンがフレームごとに、handleTickEventハンドラを呼び出します。 10番目のフレームで、アプリケーション･コードが、box1によってカバーされる領域の再描画を要求します。 これに反応して、グラフィック･エンジンが、box1ウィジェットに保存されている色を使用して、フレームバッファ内でこの領域を再描画します。</p><p>下に示すユーザ･インタフェースでは、バックグラウンド画像上にButtonウィジェットとBoxウィジェットがあります。 ButtonがクリックされたときにBoxの色が変更されるように、Buttonにインタラクションを挿入した場合、ユーザがButtonをクリックすると2つの無効化領域（赤色で表示）が生まれます。</p><div class="figure noshadow"><a href="/4.21/ja/img/basic-concepts/rendering/button-and-box.webp" target="_blank"><img width="480" src="/4.21/ja/img/basic-concepts/rendering/button-and-box.webp"></a><p>2つの無効化領域</p></div><p>Boxの領域は無効化され、フレームバッファ内で新しい色が描画されます。 Buttonは自身も無効化し、再び解放状態の描画になります。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="render">Render（描画）<a class="hash-link" href="#render" title="見出しに直接リンク">​</a></h2><p>前述したように、更新フェーズの結果として、再描画する領域（無効化領域）のリストが作成されます。 描画フェーズのタスクは、基本的にはこのリストの順番に沿って、これらの領域をカバーするウィジェットをフレームバッファに描画していくことです。</p><p>このフェーズはグラフィック･エンジンによって自動的に処理されます。 アプリケーションはシーン･モデル（UIのウィジェット）を定義済みで、一部の領域を無効化しています。 残りはエンジンが処理します。</p><p>グラフィック･エンジンは無効化領域を1つずつ処理します。 領域ごとに、エンジンはシーン･モデルをスキャンし、その領域によって（一部または全体が）カバーされるウィジェットのリストを収集します。</p><p>このウィジェットのリストが入手できたら、グラフィック･エンジンはウィジェット上で描画メソッドを呼び出します。 バックグラウンドのウィジェットから始まり、最前面のウィジェットが最後です。</p><p>ウィジェットの描画メソッドは、フレームバッファへの描画時に、そのウィジェットの状態（色など）を使用します。 ウィジェットの描画に必要な情報はすべて、更新フェーズの間にウィジェットに保存されている必要があります。 そうでない場合、描画フェーズでこの情報を使用できません。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="wait">Wait（待機）<a class="hash-link" href="#wait" title="見出しに直接リンク">​</a></h2><p>TouchGFXグラフィック･エンジンは、次のフレームの更新と描画の前に、信号を待ちます。 フレームをできる限り速く連続で描画するのではなく、フレームとフレームの間で待機するのには2つの理由があります。</p><ul><li><p>描画はディスプレイと同期します。 前述のとおり、一部のディスプレイではフレームバッファを繰り返し転送する必要があります。 この転送中に、勝手にフレームバッファに描画することはお勧めできません。 このためグラフィック･エンジンは、転送の開始後、描画開始まで短い時間待機します。 その他のディスプレイは、フレームバッファを転送する必要があるときには、マイクロコントローラに信号を送信します。 グラフィック･エンジンはこの信号を待ちます。</p></li><li><p>フレームは、固定レートで描画されます。 多くの場合、フレームが固定レートで描画される方がアプリケーションにとっては都合がよいです。一定時間続くアニメーションを簡単に作成できるからです。 たとえば、60 Hzのディスプレイがある場合、2秒のアニメーションを表示するには、120フレームで完了するようにプログラミングすることになります。</p></li></ul><p>グラフィック･エンジンが待機している時間は、通常、アプリケーションの中で他の優先度の低いプロセスに使用されます。 このような場合、時間の無駄にはなりません。いずれにせよ、こうした優先度の低いプロセスはどこかの時点で実行する必要があるからです。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="handling-the-framebuffers">フレームバッファの処理<a class="hash-link" href="#handling-the-framebuffers" title="見出しに直接リンク">​</a></h2><p>グラフィック･エンジンは、フレームバッファの更新前にディスプレイと同期するという、これまでの説明を思い出してください。 フレームバッファへの描画後、グラフィック・エンジンは、ディスプレイに更新後のフレームバッファが表示されていることを確認する必要もあります。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="two-framebuffers">2つのフレームバッファ<a class="hash-link" href="#two-framebuffers" title="見出しに直接リンク">​</a></h3><p>最もシンプルなセットアップでは、2つのフレームバッファを使用できます。 グラフィック･エンジンは、2つのフレームバッファ間を切り替えます。 フレームを1つのフレームバッファに描画するときに、もう一方のフレームバッファからディスプレイに転送（および表示）されます。</p><div class="figure noshadow"><a href="/4.21/ja/img/basic-concepts/rendering/engine-cycle-2fb-normal.webp" target="_blank"><img src="/4.21/ja/img/basic-concepts/rendering/engine-cycle-2fb-normal.webp"></a><p>ダブル･フレームバッファ</p></div><p>この図では、パラレルRGBディスプレイが、LTDCコントローラに接続されているものとします。 つまり、フレームごとに、フレームバッファをディスプレイに転送する必要があります。 フレームバッファが2つあるので、グラフィック･エンジンは、1つのフレームバッファから転送中に、もう一方のフレームバッファに描画することができます。 このスキームはとても上手く機能するので、バッファを2つ持つことが可能であれば推奨されます。</p><p>上の図では、グラフィック･エンジンがフレームごとに描画を行うので、すべてのフレームで新しいフレームバッファの転送も行っています。</p><p>アプリケーションが何も更新を行わないフレームが存在することはよくあります。 何も描画されていないということです。 つまり、後続のフレームでは同じフレームバッファが再び転送されることになります。</p><div class="figure noshadow"><a href="/4.21/ja/img/basic-concepts/rendering/engine-cycle-2fb-no-update.webp" target="_blank"><img src="/4.21/ja/img/basic-concepts/rendering/engine-cycle-2fb-no-update.webp"></a><p>フレーム2では更新なし</p></div><p>アプリケーションはフレーム2では何も描画していないので、グラフィック･エンジンはフレーム3でフレームバッファ2を再転送します。</p><p>一般的なパラレルRGBディスプレイのリフレッシュ･レートはおよそ60 Hzです。 マイクロコントローラは、この更新頻度を維持する必要があります。 この更新頻度は、再び転送を開始する前に、新しいフレームを描画するための時間が16 msであることを意味します。 場合によっては、新しいフレームの描画時間が16 msを超えることもあります。 この場合、グラフィック･エンジンは単純に（前と）同じフレームをもう一度転送します。</p><div class="figure noshadow"><a href="/4.21/ja/img/basic-concepts/rendering/engine-cycle-2fb-long-render.webp" target="_blank"><img src="/4.21/ja/img/basic-concepts/rendering/engine-cycle-2fb-long-render.webp"></a><p>描画時間が長い場合</p></div><p>フレーム1の描画時間は16 msを超えているので、前にフレームバッファ1に描画されたフレーム0が再転送されています。 フレームバッファ2の新しいフレームは、フレーム3で転送されます。 2つのフレームバッファが使用可能な場合、描画時間が非常に長くなる可能性があります。 新しいフレームの準備ができるまで、前のフレームが何度も再転送されます。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="one-framebuffer">1つのフレームバッファ<a class="hash-link" href="#one-framebuffer" title="見出しに直接リンク">​</a></h3><p>一部のシステムでは、1つのフレームバッファ用のメモリしかないことがあります。 パラレルRGBディスプレイを使用する場合には、すべてのフレームをフレームバッファ1で転送せざるを得ません。</p><p>グラフィック･エンジンが強制的に描画するフレームバッファは、同時にディスプレイに転送もされているため、問題が発生しやすくなります。 注意して実行しなければ、前のフレームと新しいフレームが混在するフレームが、ディスプレイに表示される危険性が高くなります。</p><p>1つの解決策は、転送が完了するまで描画を保留し、転送が再開されるまでの時間枠でのみ描画することです。 転送時間がフレーム時間全体のかなりの部分を占めるので、これによって稼げる描画のための時間はわずかです。 もう1つの短所として、次の転送の開始時に描画が完了していない場合、やはり不完全なフレーム（ティアリング）が発生する可能性があります。</p><p>もう少し可能性の高い解決策は、転送済みのフレームバッファの量を追跡し、フレームバッファの当該部分への描画を制限することです。 転送が進むにつれ、描画アルゴリズムで使用可能なフレームバッファの量は増えていきます。</p><p>グラフィック･エンジンには、描画が正しく実行されていることをプログラマが確認するために役立つアルゴリズムが含まれています。</p><p>アプリケーションはフレームごとに、フレームバッファを更新し、描画します。</p><div class="figure noshadow"><a href="/4.21/ja/img/basic-concepts/rendering/engine-cycle-1fb-normal.webp" target="_blank"><img src="/4.21/ja/img/basic-concepts/rendering/engine-cycle-1fb-normal.webp"></a><p>フレームごとに1つのフレームバッファが再転送される</p></div><p>フレーム内で何も更新が行われていない場合、フレームバッファは変更なしで再転送されます。</p><p>描画時間が16 msを超える場合、再転送の開始時に描画が終了していません。</p><div class="figure noshadow"><a href="/4.21/ja/img/basic-concepts/rendering/engine-cycle-1fb-long-render.webp" target="_blank"><img src="/4.21/ja/img/basic-concepts/rendering/engine-cycle-1fb-long-render.webp"></a><p>描画時間が長い場合</p></div><p>この状況では、グラフィック･エンジンは、転送されている部分が完全に描画済みであることを確認する必要があります。 そうでない場合、ディスプレイに未完成のフレームバッファが表示されます。</p><p>次のセクションでは、個々のウィジェットの描画時間について説明します。 プログラマが高パフォーマンスのアプリケーションを作成するために役立つ内容です。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメント･ページのナビゲーション"><a class="pagination-nav__link pagination-nav__link--prev" href="/4.21/ja/docs/basic-concepts/graphics-engine"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">グラフィック･エンジン</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/4.21/ja/docs/basic-concepts/performance"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">パフォーマンス</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#collect" class="table-of-contents__link toc-highlight">Collect（収集）</a></li><li><a href="#update" class="table-of-contents__link toc-highlight">Update（更新）</a><ul><li><a href="#time-based-updates" class="table-of-contents__link toc-highlight">タイムベース更新</a></li><li><a href="#requesting-a-redraw" class="table-of-contents__link toc-highlight">再描画の要求</a></li></ul></li><li><a href="#render" class="table-of-contents__link toc-highlight">Render（描画）</a></li><li><a href="#wait" class="table-of-contents__link toc-highlight">Wait（待機）</a></li><li><a href="#handling-the-framebuffers" class="table-of-contents__link toc-highlight">フレームバッファの処理</a><ul><li><a href="#two-framebuffers" class="table-of-contents__link toc-highlight">2つのフレームバッファ</a></li><li><a href="#one-framebuffer" class="table-of-contents__link toc-highlight">1つのフレームバッファ</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2023 STMicroelectronics | <a href="https://www.st.com/content/st_com/ja/common/terms-of-use.html">ご利用条件</a> | <a href="https://www.st.com/content/st_com/ja/common/privacy-policy.html">プライバシー･ポリシー</a> | <a href="/docs/miscellaneous/cookie-policy">Cookieポリシー</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">権利行使</a></div></div></div></footer></div></div>
<script src="/4.21/ja/assets/js/runtime~main.cad63f94.js"></script>
<script src="/4.21/ja/assets/js/main.865d9041.js"></script>
</body>
</html>