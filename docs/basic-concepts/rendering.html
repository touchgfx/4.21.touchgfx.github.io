<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-basic-concepts/rendering">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.21/opensearch.xml">
<script src="/4.21/js/one-trust.js"></script>
<link rel="icon" href="/4.21/img/icons/icon-192x192.png">
<link rel="manifest" href="/4.21/manifest.json">
<meta name="theme-color" content="rgb(21, 142, 194)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/4.21/img/icons/icon-192x192.png">
<link rel="mask-icon" href="/4.21/img/icon.svg" color="rgb(21, 142, 194)">
<meta name="msapplication-TileImage" content="/4.21/img/icons/icon-192x192.png">
<meta name="msapplication-TileColor" content="#000">
<script src="/4.21/js/fix-location.js"></script><title data-rh="true">Main Loop | TouchGFX Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://support.touchgfx.com/4.21/img/meta-image.png"><meta data-rh="true" name="twitter:image" content="https://support.touchgfx.com/4.21/img/meta-image.png"><meta data-rh="true" property="og:url" content="https://support.touchgfx.com/4.21/docs/basic-concepts/rendering"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Main Loop | TouchGFX Documentation"><link data-rh="true" rel="icon" href="/4.21/img/favicon.png"><link data-rh="true" rel="canonical" href="https://support.touchgfx.com/4.21/docs/basic-concepts/rendering"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/basic-concepts/rendering" hreflang="en"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ko/docs/basic-concepts/rendering" hreflang="ko"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ja/docs/basic-concepts/rendering" hreflang="ja"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-CN/docs/basic-concepts/rendering" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-TW/docs/basic-concepts/rendering" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/basic-concepts/rendering" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.21/assets/css/styles.56327e77.css">
<link rel="preload" href="/4.21/assets/js/runtime~main.2b9ba5f9.js" as="script">
<link rel="preload" href="/4.21/assets/js/main.6179f8c3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.21/docs/introduction/welcome"><div class="navbar__logo"><img src="/4.21/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--light_HNdA"><img src="/4.21/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">English</a><ul class="dropdown__menu"><li><a href="/4.21/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/4.21/ko/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li><li><a href="/4.21/ja/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/4.21/zh-CN/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">简体中文</a></li><li><a href="/4.21/zh-TW/docs/basic-concepts/rendering" target="_self" rel="noopener noreferrer" class="dropdown__link">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/4.21/docs/introduction/welcome">4.21</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.21/docs/basic-concepts/rendering">4.21</a></li><li><a href="https://support.touchgfx.com/4.20" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.20<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.19" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.19<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.18" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.18<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.17" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.17<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.16" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.16<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/introduction">Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/4.21/docs/category/basic-concepts">Basic Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Basic Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/embedded-graphics">Embedded Graphics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/color-formats">Color Formats</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/framebuffer">Framebuffer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/graphics-engine">Graphics Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.21/docs/basic-concepts/rendering">Main Loop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/performance">Performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/operating-system">Operating Systems</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/memory-usage">Memory Usage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/development/development-introduction">Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/miscellaneous-1">Miscellaneous</a><button aria-label="Toggle the collapsible sidebar category &#x27;Miscellaneous&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.21/docs/api/classes/classtouchgfx_1_1_abstract_button">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/resources">Resources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Resources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/4.21/docs/category/basic-concepts"><span itemprop="name">Basic Concepts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Main Loop</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Main Loop</h1></header><p>In this section you will learn more about the workings of the graphics
engine in TouchGFX and in particular the main loop.
Recall that the main task for the graphics engine is to render the
graphics (the ui model) of your application in to the
framebuffer. This process happens over and over again to produce new
frames on the display.</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/rendering/engine-cycle.webp" target="_blank"><img width="320" src="/4.21/img/basic-concepts/rendering/engine-cycle.webp"></a><p></p></div><p>The graphics engine <em>collects</em> external events like display touches or
button presses. These events are filtered and forwarded to the
application. The application can use these events to update the ui
model. E.g. by changing a button to its pressed state when the user
touches the screen over the button, and later changing the button
back to the released state when the user does not touch the screen
anymore.</p><p>Finally the graphics engine renders the updated model to the
framebuffer. This process loops forever.</p><p>After rendering a frame, the framebuffer is transferred to the display,
where the user can see the graphics.
The transfer to the display must be synchronized with the display to
avoid disturbing glitches on the display. For some displays the
transfers must happen regularly with a minimum time interval. For
other displays the transfer must happen when a signal is sent from the
display.</p><p>The graphics engine implements this synchronization by waiting for a
&quot;go&quot; signal from the hardware abstraction layer. Read more about the
hardware abstraction layer
<a href="/4.21/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction">here</a></p><p>In pseudo code the main loop inside the TouchGFX graphics engine looks
like this:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">collect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Collect events from outside</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Update the application ui model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">render</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Render new updated graphics to the framebuffer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">wait</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Wait for &#x27;go&#x27; from display</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code is more involved in the real implementation, but the pseudo
code above helps in understanding the main parts of the engine.</p><p>We will discuss these four stages in more detail below.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="collect">Collect<a class="hash-link" href="#collect" title="Direct link to heading">​</a></h2><p>In this phase the graphics engine collects events from the outside
environment. These events are typically touch events and buttons.</p><p>TouchGFX samples and propagates events to the application. The raw
touch events are converted into more specific touch events:</p><ul><li><strong>Click:</strong>
The user pressed or released his finger from the display</li><li><strong>Drag:</strong>
The user moved his finger on the display (while touching the
display).</li><li><strong>Gestures:</strong>
The user moved his finger fast in a direction and then
released. This is called a <em>swipe</em> and is recognized by the graphics
engine.</li></ul><p>The events are forwarded to the ui elements (e.g. widgets) that are
currently active.</p><p>The engine also forwards a <em>tick</em> event. This event represents the new
frame (or the step in time), and is always send, also if there was no
other external input. This event is used by applications to drive
animations, or other time-based actions like changing to a pause screen
after a specific time has elapsed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="update">Update<a class="hash-link" href="#update" title="Direct link to heading">​</a></h2><p>Here the graphics engine works together with the application
to update the ui to reflect the collected events. The graphics engine
knows which Screen is currently active and passes events to
this object.</p><p>The basic principle is that the engine informs the application
(i.e. the Screen and Widget objects in the ui model) about the
events. In response, the application requests specific parts of the
display to be redrawn. The application does not draw directly as
response to the events, it changes the properties of Widgets and requests a redraw of the Widget.</p><p>If for example a Click event occurs, the graphics engine searches the
scene model of the Screen object to find the Widget that should
receive the event (the topmost widget below the touch point). Some
Widgets like Image and TextArea do not wish to receive Click events,
so they are disregarded. They also have an empty event handler.</p><p>Other Widgets like Button reacts to a Click event (pressed or
released). The Button widget, for example, changes its state to show
another image when pressed, and changes the state back again when the
touch is released again.</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/rendering/button-on-image.webp" target="_blank"><img width="480" src="/4.21/img/basic-concepts/rendering/button-on-image.webp"></a><p>Image widget in the background with a Button widget in front</p></div><p>When a Widget like the Button changes its state, it must also be
redrawn in the framebuffer. The Widget is responsible for
communicating this back to the graphics engine as response to the
event. The graphics engine does not on its own redraw any Widgets
based on the collected events.
The Widgets keep track of their own internal state (for a Button, what
image to draw), and instruct the graphics engine to redraw the part (a
rectangle) of the display that is covered by the Widget.</p><p>The application itself can also react to the events. One of two ways are common:</p><ul><li><strong>Configure an
<a href="/4.21/docs/development/ui-development/designer-user-guide/interactions-view">interaction</a>
for a Widget in TouchGFX Designer</strong>
For example, we can configure an interaction to make another Widget
visible when the Button is pressed. This interaction is executed
after the Button has changed its state and requested a redraw of
itself from the graphics engine. If you use the interaction to show
another (invisible) Widget, the application should also request a
redraw from the graphics engine.</li><li><strong>React to events on the Screen</strong>
It is also possible to react to events in the Screen itself. The
event handlers are virtual functions on the Screen class (see list below). These
functions can be reimplemented in the Screens in the
application. This can e.g. be used to perform an action whenever the
user touches the screen (no matter where if the touch is on a Widget).</li></ul><p>The Screen class has the following event handlers. These are called by
the graphics engine when the corresponding external event has been
collected:</p><div class="code-header"><div><h5>framework/include/touchgfx/Screen.hpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleClickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> ClickEvent</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleDragEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> DragEvent</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleGestureEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> GestureEvent</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleKeyEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">uint8_t</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Any C++ code can be inserted in these event handlers. Typically
applications update the state of some Widgets and/or call some
application specific functions (business logic).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="time-based-updates">Time based updates<a class="hash-link" href="#time-based-updates" title="Direct link to heading">​</a></h3><p>The handleTickEvent event handler is called in every frame. This
allows the application to perform time based updates of the user
interface. An example could be to fade a Widget away after 10
seconds. Assuming that we have 60 frames in a second (10 seconds is
then 600 ticks), the code could look like:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Screen1ViewBase</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Call superclass eventhandler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">600</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        myWidget</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">startFadeAnimation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Fade to 0 = invisible in 20 frames</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The graphics engine also calls an event handler on the Model
class. This event handler is typically used to perform repeated
actions like checking message queues or sampling GPIO:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Model</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">tick</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sampleGPIO_Input1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Sample polled IO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The eventhandler on a specific Screen subclass is only called when
that screen is the active screen. The eventhandler on the Model class
is always called (independently of which Screen is active). This makes
the Model eventhandler suitable for &quot;application wide&quot; logic.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requesting-a-redraw">Requesting a redraw<a class="hash-link" href="#requesting-a-redraw" title="Direct link to heading">​</a></h3><p>As we discussed above with the Button example; the Widgets are
responsible for requesting a redraw when their state changes. The
mechanism behind this is called an <em>invalidated area</em>.</p><p>When the Button changes state (e.g. from released to pressed) and
needs a redraw, the area covered by the Button Widget is an
invalidated area. The graphics engine keeps a list of these
invalidated areas requested for the frame. All the collected events
(touch, button, tick) may result in one or more invalidated areas, so
there can be many invalidated areas in every frame.</p><p>The event handlers on the Screen class can also request a redraw of an
area. Here we change the color of a Box widget, box1, in frame 10 and
request a redraw by calling the <em>invalidate</em> method on the Box:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">Screen1ViewBase</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">                          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Call superclass eventhandler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        box1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setColor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">Color</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getColorFromRGB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0xFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Set color to red</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        box1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">invalidate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">                                       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Request redraw</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example the graphics engine will call the <em>handleTickEvent</em>
handler in every frame. In the 10th frame, the application code
requests a redraw of the area covered by <em>box1</em>. As a response to this
the graphics engine will redraw that area in the framebuffer using the
color saved in the <em>box1</em> widget.</p><p>In the user interface below we have a Button Widget and a Box Widget
on top of a background image. If we insert an interaction on the
Button to change the color of the Box when the Button is clicked we
get two invalidated areas (indicated with red) when the user clicks
the Button:</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/rendering/button-and-box.webp" target="_blank"><img width="480" src="/4.21/img/basic-concepts/rendering/button-and-box.webp"></a><p>Two invalidated areas</p></div><p>The area of the Box is invalidated to get the new color drawn in the
framebuffer. The Button also invalidates itself to get the released
state drawn again.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="render">Render<a class="hash-link" href="#render" title="Direct link to heading">​</a></h2><p>As we just discussed, the result of the update phase is a list of
areas to redraw, the invalidated areas. The task for the render phase
is basically to run through this list and draw the Widgets covering
these areas into the framebuffer.</p><p>This phase is handled automatically by the graphics engine. The
application has defined the scene model (the Widgets in the ui) and
invalidated some area. The rest is handled by the engine.</p><p>The graphics engine handles the invalidated areas one-by-one. For each
area the engine scans the scene model and collects a list of the
widgets that is covered by the area (partly or in whole).</p><p>Given this list of Widgets the graphics engine calls the draw method
on the Widgets. Starting with the widget in the background and ending
with the foremost Widget.</p><p>The Widget&#x27;s draw methods use the state of the Widget, e.g. the color,
when drawing to the framebuffer. Any information that is needed to
draw the Widget must be saved to the Widget during the update
phase. Otherwise this information is not available in the rendering
phase.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="wait">Wait<a class="hash-link" href="#wait" title="Direct link to heading">​</a></h2><p>The TouchGFX graphics engine waits for a signal before updating and
rendering the next frame. There are two reasons for waiting between
the frames instead of just continuously rendering frames as fast as
possible:</p><ul><li><p>The rendering is synchronized with the display.
As mentioned above some displays requires that the framebuffer is
transmitted repeatedly. While this transmission is ongoing, it is
not advisable to render arbitrarily to the framebuffer. The
graphics engine therefore waits for a short time after the
transmission is started before starting the rendering.
Other displays send a signal to the microcontroller when the
framebuffer should be transmitted. The graphics engine waits for
that signal.</p></li><li><p>Frames are rendered at a fixed rate.
It is often beneficial for the application that frames are rendered
at a fixed rate, as this makes it easier to create animations that
lasts a specific time.
For example, if you have a 60 Hz display, a two seconds animation
should be programmed to complete in 120 frames.</p></li></ul><p>The time where the graphics engine is waiting is typically used by
other lower priority processes in the application. In these cases the
time is not wasted, as the lower priority processes should run at some
point in time anyway.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="handling-the-framebuffers">Handling the framebuffers<a class="hash-link" href="#handling-the-framebuffers" title="Direct link to heading">​</a></h2><p>Recall from the discussion previously that the graphics engine
synchronizes with the display before the framebuffer is updated. After
the rendering to the framebuffer the engine also needs to make sure
that the display shows the updated framebuffer.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="two-framebuffers">Two framebuffers<a class="hash-link" href="#two-framebuffers" title="Direct link to heading">​</a></h3><p>In the simplest setup we have two framebuffers available. The graphics
engine alternates between the two framebuffers. While drawing a frame
into a framebuffer, the other framebuffer is transferred to (and shown on) the
display.</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/rendering/engine-cycle-2fb-normal.webp" target="_blank"><img src="/4.21/img/basic-concepts/rendering/engine-cycle-2fb-normal.webp"></a><p>Double framebuffers</p></div><p>In this drawing we assume a parallel RGB display connected to the LTDC
controller. This means that a framebuffer must be transmitted to the
display in every frame. As we have two framebuffers the graphics engine
can draw into one framebuffer while the other framebuffer is being
transmitted. This scheme works very well and is preferred if possible.</p><p>As the graphics engine is drawing in every frame we also transmit a
new framebuffer in all frames in the above drawing.</p><p>There will often be frames where the application is not updating
anything. This implies that nothing is rendered. The same framebuffer
is therefore transmitted again in the succeeding frame.</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/rendering/engine-cycle-2fb-no-update.webp" target="_blank"><img src="/4.21/img/basic-concepts/rendering/engine-cycle-2fb-no-update.webp"></a><p>No update in frame 2</p></div><p>The application is not drawing anything in frame 2, so the graphics
engine retransmits framebuffer 2 again in frame 3.</p><p>The typical parallel RGB display has a refresh rate around 60 Hz. This
update frequency must be maintained by the microcontroller. This
update frequency means that we have 16 ms to render a new frame before
the transmit begins again. In some cases the time to render a new
frame is more than 16 ms. In this case the graphics engine just
retransmit the same frame again (as before):</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/rendering/engine-cycle-2fb-long-render.webp" target="_blank"><img src="/4.21/img/basic-concepts/rendering/engine-cycle-2fb-long-render.webp"></a><p>Long render time</p></div><p>The rendering of frame 1 takes more than 16 ms, so the frame 0
previously rendered to framebuffer 1 is retransmitted. The new frame
in framebuffer 2 is transmitted in frame 3. When two framebuffers are
available, the rendering time can be very long. The previous frame is
retransmitted until the new frame is available.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="one-framebuffer">One framebuffer<a class="hash-link" href="#one-framebuffer" title="Direct link to heading">​</a></h3><p>In some systems there is only memory for one framebuffer. If we have a
parallel RGB display we are thus forced to transmit framebuffer 1 in
every frame.</p><p>This can be problematic because the graphics engine is forced to draw into
the same framebuffer that we are also transmitting to the display at
the same time. If this is done without care there is a high risk that
the display shows a frame that is a mix of the previous frame and the
new.</p><p>One solution is to hold back the drawing until the transfer is
complete and only draw in the time-slot before the transfer starts
again. This yields little time to draw as the transfer takes up a significant part of the overall frame time. Another drawback is that incomplete frames (tearing) might still occur if the drawing is not complete when the next transfer starts.</p><p>A more potential solution is to keep track of how much of the
framebuffer is already transmitted and then limit the rendering to the appropriate part of the framebuffer. As the transfer progresses more and more of the framebuffer is available for the rendering algorithms.</p><p>The graphics engine contains algorithms that help the programmer to
ensure that the drawing is performed correctly.</p><p>The application updates and renders the framebuffer in every frame:</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/rendering/engine-cycle-1fb-normal.webp" target="_blank"><img src="/4.21/img/basic-concepts/rendering/engine-cycle-1fb-normal.webp"></a><p>A single framebuffer is retransmitted in every frame</p></div><p>The framebuffer is retransmitted unchanged if nothing is updated in a frame.</p><p>If the rendering time is longer than 16 ms the rendering has not
finished when the retransmission starts again:</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/rendering/engine-cycle-1fb-long-render.webp" target="_blank"><img src="/4.21/img/basic-concepts/rendering/engine-cycle-1fb-long-render.webp"></a><p>Long render time</p></div><p>In this situation the graphics engine must make sure that the part
that is being transmitted is rendered completely. Otherwise the
display will show the unfinished framebuffer.</p><p>In the next section we will discuss the rendering time for the
individual Widgets. This will help the programmer to write applications
of high performance.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/4.21/docs/basic-concepts/graphics-engine"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Graphics Engine</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/4.21/docs/basic-concepts/performance"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Performance</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#collect" class="table-of-contents__link toc-highlight">Collect</a></li><li><a href="#update" class="table-of-contents__link toc-highlight">Update</a><ul><li><a href="#time-based-updates" class="table-of-contents__link toc-highlight">Time based updates</a></li><li><a href="#requesting-a-redraw" class="table-of-contents__link toc-highlight">Requesting a redraw</a></li></ul></li><li><a href="#render" class="table-of-contents__link toc-highlight">Render</a></li><li><a href="#wait" class="table-of-contents__link toc-highlight">Wait</a></li><li><a href="#handling-the-framebuffers" class="table-of-contents__link toc-highlight">Handling the framebuffers</a><ul><li><a href="#two-framebuffers" class="table-of-contents__link toc-highlight">Two framebuffers</a></li><li><a href="#one-framebuffer" class="table-of-contents__link toc-highlight">One framebuffer</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2023 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">Terms of use</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">Privacy Policy</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie Policy</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">Exercise your rights</a></div></div></div></footer></div></div>
<script src="/4.21/assets/js/runtime~main.2b9ba5f9.js"></script>
<script src="/4.21/assets/js/main.6179f8c3.js"></script>
</body>
</html>