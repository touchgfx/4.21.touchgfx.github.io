<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-basic-concepts/performance">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.21/opensearch.xml">
<script src="/4.21/js/one-trust.js"></script>
<link rel="icon" href="/4.21/img/icons/icon-192x192.png">
<link rel="manifest" href="/4.21/manifest.json">
<meta name="theme-color" content="rgb(21, 142, 194)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/4.21/img/icons/icon-192x192.png">
<link rel="mask-icon" href="/4.21/img/icon.svg" color="rgb(21, 142, 194)">
<meta name="msapplication-TileImage" content="/4.21/img/icons/icon-192x192.png">
<meta name="msapplication-TileColor" content="#000">
<script src="/4.21/js/fix-location.js"></script><title data-rh="true">Performance | TouchGFX Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://support.touchgfx.com/4.21/img/meta-image.png"><meta data-rh="true" name="twitter:image" content="https://support.touchgfx.com/4.21/img/meta-image.png"><meta data-rh="true" property="og:url" content="https://support.touchgfx.com/4.21/docs/basic-concepts/performance"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Performance | TouchGFX Documentation"><link data-rh="true" rel="icon" href="/4.21/img/favicon.png"><link data-rh="true" rel="canonical" href="https://support.touchgfx.com/4.21/docs/basic-concepts/performance"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/basic-concepts/performance" hreflang="en"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ko/docs/basic-concepts/performance" hreflang="ko"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ja/docs/basic-concepts/performance" hreflang="ja"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-CN/docs/basic-concepts/performance" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-TW/docs/basic-concepts/performance" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/basic-concepts/performance" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.21/assets/css/styles.56327e77.css">
<link rel="preload" href="/4.21/assets/js/runtime~main.2b9ba5f9.js" as="script">
<link rel="preload" href="/4.21/assets/js/main.6179f8c3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.21/docs/introduction/welcome"><div class="navbar__logo"><img src="/4.21/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--light_HNdA"><img src="/4.21/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">English</a><ul class="dropdown__menu"><li><a href="/4.21/docs/basic-concepts/performance" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/4.21/ko/docs/basic-concepts/performance" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li><li><a href="/4.21/ja/docs/basic-concepts/performance" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/4.21/zh-CN/docs/basic-concepts/performance" target="_self" rel="noopener noreferrer" class="dropdown__link">简体中文</a></li><li><a href="/4.21/zh-TW/docs/basic-concepts/performance" target="_self" rel="noopener noreferrer" class="dropdown__link">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/4.21/docs/introduction/welcome">4.21</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.21/docs/basic-concepts/performance">4.21</a></li><li><a href="https://support.touchgfx.com/4.20" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.20<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.19" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.19<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.18" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.18<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.17" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.17<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.16" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.16<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/introduction">Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/4.21/docs/category/basic-concepts">Basic Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Basic Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/embedded-graphics">Embedded Graphics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/color-formats">Color Formats</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/framebuffer">Framebuffer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/graphics-engine">Graphics Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/rendering">Main Loop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.21/docs/basic-concepts/performance">Performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/operating-system">Operating Systems</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/basic-concepts/memory-usage">Memory Usage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/development/development-introduction">Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/miscellaneous-1">Miscellaneous</a><button aria-label="Toggle the collapsible sidebar category &#x27;Miscellaneous&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.21/docs/api/classes/classtouchgfx_1_1_abstract_button">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/resources">Resources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Resources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/4.21/docs/category/basic-concepts"><span itemprop="name">Basic Concepts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Performance</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Performance</h1></header><p>In this section we will discuss performance aspects of an embedded
graphical user interface.</p><p>A high performance is here defined as getting a high frame rate while
still obtaining the desired graphical effects and animations.</p><p>Let&#x27;s recall from the previous section how the frame rate of the user
interface is affected by the main loop. Assume again that there is a
parallel RGB display attached to the LTDC and two framebuffers.
The basic situation is illustrated below:</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/rendering/engine-cycle-2fb-normal.webp" target="_blank"><img src="/4.21/img/basic-concepts/rendering/engine-cycle-2fb-normal.webp"></a><p>Double framebuffers</p></div><p>As the display is assumed refreshed 60 times each second there is approximately
16 ms between each refresh.
The calculation is this: 1 s / 60 = 0.01667 s = 16.67 ms.</p><p>TouchGFX starts drawing frame 1 into framebuffer 2 at the time where the
transfer of framebuffer 1 has started. If the rendering of
frame 1 is finished before the next transfer starts we can transfer framebuffer 2.
If not finished within 16.67 ms framebuffer 1 is transferred
again and the display will appear unchanged:</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/rendering/engine-cycle-2fb-long-render.webp" target="_blank"><img src="/4.21/img/basic-concepts/rendering/engine-cycle-2fb-long-render.webp"></a><p>Main loop time above 16.67 ms</p></div><p>This situation is denoted a lost frame.</p><p>The time for the collect and update phases are typically minuscule, e.g. less than 1 ms, and therefore more or less neglectable when considering the overall time taken of the main loop. Therefore, in the following and in general, when considering render time, this includes the collect and update phases.</p><p>If the rendering time in many frames exceeds the 16.67 ms time limit the
frame rate on the display will be 30 frames per second (fps).</p><p>If the rendering generally is shorter than 16.67 ms, but in some
frames longer than 16.67 ms, the frame rate may be close to 60 fps in
average, but the animation may not appear fluent to the
user. Depending on the application it can look like some steps in the
animation are fast and some are slow. This is not desireable.</p><p>The rendering time can also be even longer. If it is just above 33 ms,
the framerate will drop to 20 fps as we only have a new frame ready on
every third transfer.</p><table><thead><tr><th>FPS</th><th>Max rendering time</th></tr></thead><tbody><tr><td>60</td><td>16.67 ms</td></tr><tr><td>30</td><td>33.34 ms</td></tr><tr><td>20</td><td>50.00 ms</td></tr><tr><td>15</td><td>66.67 ms</td></tr></tbody></table><p>The table shows the maximum rendering time (including the collect and
update phases) that is available for a given framerate.</p><p>To achieve a good performance of a user interface it can be very
beneficial to check and monitor the frame rate regularly. Two
approaches can be used:</p><ul><li>Measure the rendering time</li><li>Count the lost frames</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="measuring-the-rendering-time">Measuring the Rendering Time<a class="hash-link" href="#measuring-the-rendering-time" title="Direct link to heading">​</a></h2><p>The first approach of measuring the rendering time gives the most
detailed information. The idea is basically to measure the time from
the frame transfer to the end of the rendering phase.
The graphics engine calls a function on the GPIO class when the
collect phase starts and makes another call when the rendering phase
ends. The application defines these function and can hook into them to
perform measurements.</p><p>The measurements can be done in two ways:</p><ul><li>Use external timing device like an oscilloscope:
To measure using an oscilloscope, the application should implement
the <code>set(GPIO_ID)</code> and <code>clear(GPIO_ID)</code> methods from the <code>GPIO</code> interface.
The oscilloscope can then measure the rendering time as the time elapsed
while the output is high.</li><li>Use an internal timer:
Another approach is to use an internal timer, like the sysTick
timer. When the GPIO::set(RENDER_TIME) is called the application can
save the value of the timer in a variable. When the clear call is
made the application can read the timer again and subtract the
previous value to get the render time. The speed of the timer will
define the resolution of the measurement. The application must
somehow make the render time visible. One way is to save the value
in a global variable and maybe show the value on the screen in a
TextArea. The value can also be checked with a debugger.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="counting-the-lost-frames">Counting the Lost Frames<a class="hash-link" href="#counting-the-lost-frames" title="Direct link to heading">​</a></h2><p>The graphics engine counts the number of transfers that has
occurred during the last collect-update-rendering phase. The
application can easily check this value to see if a frame
was lost and the frame rate therefore lowered.</p><p>The count is available in the <em>HAL</em> class:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">handleTickEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tickCounter </span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">HAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">getInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token function" style="color:rgb(130, 170, 255)">getLCDRefreshCount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Alert programmer somehow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="compensating-for-lost-frames">Compensating for Lost Frames<a class="hash-link" href="#compensating-for-lost-frames" title="Direct link to heading">​</a></h3><p>When frames are lost and the framerate of one of our animations therefore lowered we can compensate to a certain degree. We can either:</p><ul><li>wait it out - let the animation go on, resulting in a longer animation duration, and possibly unsmooth animation.</li><li>skip some frames - make sure that the overall animation does not take longer time than intended by skipping frames.</li></ul><p>TouchGFX can be instructed to automaticallly skip some frames, when frames are lost. This can be accomplished by ticking animations more than once per actual frame. This can help in making animations more fluent when the render time is uneven.</p><div class="code-header"><div><h5>HAL.hpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setFrameRateCompensation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> enabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-affects-the-rendering-time">What Affects the Rendering Time?<a class="hash-link" href="#what-affects-the-rendering-time" title="Direct link to heading">​</a></h2><p>A number of different things affect the rendering time: The size of
the updated parts, the use of layering, the complexity of the widgets,
and the available hardware support for the rendering.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-much-of-the-screen-is-updated">How Much of the Screen Is Updated?<a class="hash-link" href="#how-much-of-the-screen-is-updated" title="Direct link to heading">​</a></h3><p>The rendering time is generally proportional to the number of pixels
that must be updated. So if an animation takes too long time to render,
a possible fix is to reduce the area of the animation. For example, if
you have a rotating image and the performance is not good enough, the
performance can be improved by reducing the size of the image.</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/performance/reducing-image-size.webp" target="_blank"><img src="/4.21/img/basic-concepts/performance/reducing-image-size.webp"></a><p>Reducing image size reduces the rendering time</p></div><p>Remember that the graphics engine redraws the
areas that the application invalidated. This means that it is
important to only invalidate the areas that actually requires a
refresh.</p><p><em>The larger the invalidated areas, the longer the render time.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-number-of-layers-in-the-graphics">The Number of Layers in the Graphics<a class="hash-link" href="#the-number-of-layers-in-the-graphics" title="Direct link to heading">​</a></h3><p>In a typical application the graphics will consist of different
elements that are stacked upon each other. If one of the elements is
updated all the elements must typically be redrawn.</p><p>A typical example of this is a background image, a frame, and some
text:</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/performance/text-in-a-frame.webp" target="_blank"><img src="/4.21/img/basic-concepts/performance/text-in-a-frame.webp"></a><p>Layering graphical elements</p></div><p>This user interface is created by putting a TextArea widget on
top of an Image widget showing a transparent frame. Both on top of
the background Image:</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/performance/text-in-a-frame-designer-4.17.webp" target="_blank"><img src="/4.21/img/basic-concepts/performance/text-in-a-frame-designer-4.17.webp"></a><p>Layering graphical elements in TouchGFX Designer</p></div><p>This solution is used very often in application. It is a very easy
solution with a high flexibility, as it is, for example, possible to
change the frame at runtime or move the frame and the text on the
background.</p><p>The problem regarding rendering time is that if the text is updated at
runtime and needs to be redrawn, the graphics engine also needs to
redraw the background and the frame; and then the new text. This increases
the time to render the text considerably.</p><p><em>The more layers in an invalidated area, the longer the render time.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-complexity-of-rendering-the-pixels">The Complexity of Rendering the Pixels<a class="hash-link" href="#the-complexity-of-rendering-the-pixels" title="Direct link to heading">​</a></h3><p>Not all pixels are equally difficult to render to the framebuffer. In
all types of rendering the graphical engine must write the resulting
pixel to the framebuffer. But the cost of calculating the pixel to
write differs.</p><p>The fixed color, e.g. used in the Box Widget, has the lowest cost, as
the calculation of a pixel is done once and reused for all the
pixels. This means that we can get a very high performance by using a
lot of Boxes. This is not recommended as the user interface will not
be of high quality.</p><p>An image has the next lowest cost of pixel calculation since the
pixels are stored in a ready to use format in the bitmaps. Calculating
the pixel to write to the framebuffer is a matter of loading the color
value from the correct place in the bitmap.</p><p>Text bears a cost comparable to images as the individual letters are
actually represented as small images. In practice the cost is higher
as the high number of small images gives rise to a considerable
&quot;start-stop&quot; cost. For example the calculation of the position of the
individual letters. In order for text to look as nice as possible, it
is represented as small images with transparency, see the notes on
transparency below.</p><p>Rotated or scaled images are more expensive. The task is again to load
the pixel value from the bitmap, but this time it is a more time
consuming calculation because the graphics engine has to incorporate
the scaling and rotation.</p><p>Geometric elements like a circle are even more expensive. This time we
cannot load the pixel color from a bitmap, but we have to calculate
both the shape of the circle and the color of individual pixels in the
circle.</p><p>Transparency adds to the cost of drawing an element. An element is
transparent if some of the pixels are not solid. This increases the
cost of drawing as the graphical engine first has to draw the element
behind the transparent element (as we saw in the &quot;text in a frame&quot;
section). Secondly the graphical engine then has to combine the
background pixel with the pixel of the transparent element and write
the result to the framebuffer. This calculation takes considerably
more time than just writing the calculated pixel.</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/performance/box-image-texture-circle.webp" target="_blank"><img src="/4.21/img/basic-concepts/performance/box-image-texture-circle.webp"></a><p>Box, Image, rotated Image, and circle. Solid elements in the first row. Transparent elements below.</p></div><p>Transparency always gives you an extra layer. But putting solid pixels
on top of other solid pixels does not always increase the number of
layers. The graphical engine tries to not draw pixels that are covered
by other solid pixels, as this would be a waste of precious time.</p><p><em>The more expensive elements in the invalidated area, the longer the render time.</em></p><p>Remember that is only the elements that are part of the invalidated
area, that adds to the rendering time. Elements outside of the
invalidated areas do not impact the rendering time.</p><p>Read more about ui components and performance <a href="/4.21/docs/development/ui-development/ui-components/general-ui-component-performance">here</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hardware-support-for-rendering">Hardware Support for Rendering<a class="hash-link" href="#hardware-support-for-rendering" title="Direct link to heading">​</a></h3><p>Some STM32 microcontrollers contain a graphical accelerator called
Chrom-ART (or DMA2D). This accelerator can reduce the rendering
time. As the accelerator runs in parallel with the microcontroller
core, the microcontroller is free to run other tasks while the
accelerator renders graphics.</p><p>Chrom-ART is mainly useful for images and text. It is automatically
used by the graphics engine when available.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="when-should-you-consider-rendering-time">When Should You Consider Rendering Time<a class="hash-link" href="#when-should-you-consider-rendering-time" title="Direct link to heading">​</a></h2><p>Rendering time is not equally important all the time. You should pay
attention to the rendering time when a slow frame rate is visible to
the user. This is typically the case when you have an animation
running on part of the screen (like a rotating icon) or when you move
or slide something across the screen. If the update frequency is low
it will appear step-wise instead of fluent to the user. If this is the
case you should check the rendering time.</p><p>On the other hand, if you replace the whole screen with a new screen,
it is normally not visible to the user if the frame rate dropped
significantly during the change. This is because the user cannot see
when the rendering started, but only when it finished.</p><p>These two rules mean that for animated elements (e.g. moving) you
should use few layers and refrain from using complex elements and many
layers. For other parts of the screen, this could be unproblematic.</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/performance/clock-and-scrolllist.webp" target="_blank"><img src="/4.21/img/basic-concepts/performance/clock-and-scrolllist.webp"></a><p>Analog clock and a scroll list</p></div><p>In this example we have an analog clock on the left. The three clock
hands are rendered by rotating small elongated images. This is
normally fine as the hands do not move all the time. But if we wanted
to move the clock around on the screen, they would be redrawn in every
frame and that could be problematic, as drawing rotated images is
typically time consuming.</p><p>On the right we have a scroll list. The user can move this list of
numbers up and down, so we need a high framerate for the user
interface to appear responsive. Therefore it is important that we
consider the rendering time of the elements in the scroll list or
reduce the size of the scroll list.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimize-performance-by-invalidating-content">Optimize Performance by Invalidating Content<a class="hash-link" href="#optimize-performance-by-invalidating-content" title="Direct link to heading">​</a></h2><p>Normally the entire widget is invalidated, but the graphics engine has
the ability to only invalidate the content of a widget, instead of the
entire widget. By reducing the area to invalidate, the render time will
often be noticeably shorter. The improvement in render time depends on:</p><ul><li>The size of the area covered by the widget content relative to the
size of the entire widget.</li><li>The background widget(s) partly or fully covered by the widget.</li></ul><p>The following figures illustrates the concept of invalidating content, by
using the TextArea widget as example. Figure 1 shows the entire
area of the widget. Figure 2 shows the invalidated area when using
<code>TextArea::invalidate()</code>. Figure 3 shows the invalidated area when using
<code>TextArea::invalidateContent()</code>.</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/performance/text-area-expanded-across-screen.webp" target="_blank"><img src="/4.21/img/basic-concepts/performance/text-area-expanded-across-screen.webp"></a><p>Figure 1. TextArea spanning across the entire screen width</p></div><div class="figure noshadow"><a href="/4.21/img/basic-concepts/performance/invalidate-example.webp" target="_blank"><img src="/4.21/img/basic-concepts/performance/invalidate-example.webp"></a><p>Figure 2. Invalidated area (red) when using TextArea::invalidate()</p></div><div class="figure noshadow"><a href="/4.21/img/basic-concepts/performance/invalidate-content-example.webp" target="_blank"><img src="/4.21/img/basic-concepts/performance/invalidate-content-example.webp"></a><p>Figure 3. Invalidated area (green) when using TextArea::invalidateContent()</p></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-using-textareainvalidatecontent">Example using TextArea::invalidateContent()<a class="hash-link" href="#example-using-textareainvalidatecontent" title="Direct link to heading">​</a></h3><p>In cases where the widget is overlapping other widgets, these other widgets
will need to be redrawn when the entire TextArea is invalidated using
<code>TextArea::invalidate()</code>. By using <code>TextArea::invalidateContent()</code> instead,
we minimize the risk of unnecessary invalidating and redrawing widgets.
This is especially true for expensive widgets, e.g. Circle, Gauge, etc.</p><p>The figure below illustrates how we avoid invalidating a background widget
(Image - ST logo) using <code>TextArea::invalidateContent()</code>. The background
widget would have been invalidated and redrawn if we used <code>TextArea::invalidate()</code>.</p><div class="figure noshadow"><a href="/4.21/img/basic-concepts/performance/invalidate-content-improvement-example.webp" target="_blank"><img src="/4.21/img/basic-concepts/performance/invalidate-content-improvement-example.webp"></a><p>Example using TextArea::invalidateContent()</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tips-to-get-good-performance">Tips To Get Good Performance<a class="hash-link" href="#tips-to-get-good-performance" title="Direct link to heading">​</a></h2><p>We end this section with a summary of the tips to obtain a good performance:</p><ul><li><strong>Do not redraw unchanged things</strong>
Make sure that you do not accidentally invalidate unnecessary parts
of the display. This reduces the performance without any benefit.</li><li><strong>Find balance between quality and speed</strong>
Reducing the complexity of the elements can improve the
performance. A good balance between this and the performance is
often the key.</li><li><strong>Utilize hardware capabilities</strong>
The capability of a microcontroller with hardware acceleration
(Chrom-ART) is often higher than a microcontroller without. Consider
using a microcontroller with Chrom-ART.</li><li><strong>Replace calculated graphics with images</strong>
The calculated circle is slower than an image of a circle. In
general images can replace many static elements.</li><li><strong>Adjust display refresh rate</strong>
As we discussed in the beginning of this section is the refresh rate
a hard limit for the rendering time. If the rendering time exceeds
the refresh rate, the frame rate drops. If your rendering time
is just a little above the refresh rate, it may be possible to lower
the refresh rate of the display to e.g. 55 Hz (corresponding to 18.2
ms), and keep the high frame rate.</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/4.21/docs/basic-concepts/rendering"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Main Loop</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/4.21/docs/basic-concepts/operating-system"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Operating Systems</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#measuring-the-rendering-time" class="table-of-contents__link toc-highlight">Measuring the Rendering Time</a></li><li><a href="#counting-the-lost-frames" class="table-of-contents__link toc-highlight">Counting the Lost Frames</a><ul><li><a href="#compensating-for-lost-frames" class="table-of-contents__link toc-highlight">Compensating for Lost Frames</a></li></ul></li><li><a href="#what-affects-the-rendering-time" class="table-of-contents__link toc-highlight">What Affects the Rendering Time?</a><ul><li><a href="#how-much-of-the-screen-is-updated" class="table-of-contents__link toc-highlight">How Much of the Screen Is Updated?</a></li><li><a href="#the-number-of-layers-in-the-graphics" class="table-of-contents__link toc-highlight">The Number of Layers in the Graphics</a></li><li><a href="#the-complexity-of-rendering-the-pixels" class="table-of-contents__link toc-highlight">The Complexity of Rendering the Pixels</a></li><li><a href="#hardware-support-for-rendering" class="table-of-contents__link toc-highlight">Hardware Support for Rendering</a></li></ul></li><li><a href="#when-should-you-consider-rendering-time" class="table-of-contents__link toc-highlight">When Should You Consider Rendering Time</a></li><li><a href="#optimize-performance-by-invalidating-content" class="table-of-contents__link toc-highlight">Optimize Performance by Invalidating Content</a><ul><li><a href="#example-using-textareainvalidatecontent" class="table-of-contents__link toc-highlight">Example using TextArea::invalidateContent()</a></li></ul></li><li><a href="#tips-to-get-good-performance" class="table-of-contents__link toc-highlight">Tips To Get Good Performance</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2023 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">Terms of use</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">Privacy Policy</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie Policy</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">Exercise your rights</a></div></div></div></footer></div></div>
<script src="/4.21/assets/js/runtime~main.2b9ba5f9.js"></script>
<script src="/4.21/assets/js/main.6179f8c3.js"></script>
</body>
</html>