<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-development/board-bring-up/how-to/02-cpu-running">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.21/opensearch.xml">
<script src="/4.21/js/one-trust.js"></script>
<script src="/4.21/js/fix-location.js"></script><title data-rh="true">2. CPU Running | TouchGFX Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://support.touchgfx.com/4.21/img/meta-image.png"><meta data-rh="true" name="twitter:image" content="https://support.touchgfx.com/4.21/img/meta-image.png"><meta data-rh="true" property="og:url" content="https://support.touchgfx.com/4.21/docs/development/board-bring-up/how-to/02-cpu-running"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="2. CPU Running | TouchGFX Documentation"><link data-rh="true" rel="icon" href="/4.21/img/favicon.png"><link data-rh="true" rel="canonical" href="https://support.touchgfx.com/4.21/docs/development/board-bring-up/how-to/02-cpu-running"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/development/board-bring-up/how-to/02-cpu-running" hreflang="en"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ko/docs/development/board-bring-up/how-to/02-cpu-running" hreflang="ko"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/ja/docs/development/board-bring-up/how-to/02-cpu-running" hreflang="ja"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-CN/docs/development/board-bring-up/how-to/02-cpu-running" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/zh-TW/docs/development/board-bring-up/how-to/02-cpu-running" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.21/docs/development/board-bring-up/how-to/02-cpu-running" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.21/assets/css/styles.2fc40eaa.css">
<link rel="preload" href="/4.21/assets/js/runtime~main.35f0f16b.js" as="script">
<link rel="preload" href="/4.21/assets/js/main.ac6e3ed7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.21/docs/introduction/welcome"><div class="navbar__logo"><img src="/4.21/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--light_HNdA"><img src="/4.21/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">English</a><ul class="dropdown__menu"><li><a href="/4.21/docs/development/board-bring-up/how-to/02-cpu-running" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/4.21/ko/docs/development/board-bring-up/how-to/02-cpu-running" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li><li><a href="/4.21/ja/docs/development/board-bring-up/how-to/02-cpu-running" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/4.21/zh-CN/docs/development/board-bring-up/how-to/02-cpu-running" target="_self" rel="noopener noreferrer" class="dropdown__link">简体中文</a></li><li><a href="/4.21/zh-TW/docs/development/board-bring-up/how-to/02-cpu-running" target="_self" rel="noopener noreferrer" class="dropdown__link">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/4.21/docs/introduction/welcome">4.21</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.21/docs/development/board-bring-up/how-to/02-cpu-running">4.21</a></li><li><a href="https://support.touchgfx.com/4.20" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.20<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.19" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.19<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.18" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.18<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.17" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.17<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.16" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.16<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/introduction">Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/basic-concepts">Basic Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Basic Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/4.21/docs/development/development-introduction">Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/4.21/docs/development/hardware-selection/hardware-selection-introduction">Hardware Selection</a><button aria-label="Toggle the collapsible sidebar category &#x27;Hardware Selection&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/4.21/docs/development/board-bring-up/board-introduction">Board Bring Up</a><button aria-label="Toggle the collapsible sidebar category &#x27;Board Bring Up&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/development/board-bring-up/how-to/01-create-project">1. Create Project</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.21/docs/development/board-bring-up/how-to/02-cpu-running">2. CPU Running</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/development/board-bring-up/how-to/03-display-internal">3. Display with framebuffer in internal RAM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/development/board-bring-up/how-to/04-enable-external-ram">4. External RAM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/development/board-bring-up/how-to/05-display-external">5. Display with framebuffer in external RAM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/development/board-bring-up/how-to/06-flash-external-addressable">6. External addressable flash</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/development/board-bring-up/how-to/07-flash-external-nonaddressable">7. External flash in block mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/development/board-bring-up/how-to/08-hardware-acceleration">8. Hardware acceleration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/development/board-bring-up/how-to/09-touch-controller">9. Touch Controller</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/development/board-bring-up/how-to/10-physical-buttons">10. Physical Buttons</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.21/docs/development/board-bring-up/how-to/11-flash-loader">11. Flash Loader</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/4.21/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction">TouchGFX AL Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;TouchGFX AL Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/4.21/docs/development/ui-development/ui-development-introduction">UI Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;UI Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/4.21/docs/category/scenarios-2">Scenarios</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scenarios&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/miscellaneous-1">Miscellaneous</a><button aria-label="Toggle the collapsible sidebar category &#x27;Miscellaneous&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.21/docs/api/classes/classtouchgfx_1_1_abstract_button">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/4.21/docs/category/resources">Resources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Resources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/4.21/docs/development/development-introduction"><span itemprop="name">Development</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/4.21/docs/development/board-bring-up/board-introduction"><span itemprop="name">Board Bring Up</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">2. CPU Running</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>2. CPU Running</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a class="hash-link" href="#motivation" title="Direct link to heading">​</a></h2><p>In this section we will make sure that the MCU core, internal RAM and
flash are running at the desired clock speed.</p><p>TouchGFX can run on any MCU speeds, but a wrong clock configuration
can lead to lower than necessary performance. Later in your board
bring up you need to configure specific timing parameters, e.g. an I2C
clock for the Touch Controller. This is impossible without ensuring
that the MCU runs with the correct speed.</p><p>For STM32 microcontrollers you setup up a system clock. This clock is
then divided down to generate the FCLK core clock and various
peripheral clocks like APB1 peripheral clock.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="goal">Goal<a class="hash-link" href="#goal" title="Direct link to heading">​</a></h2><p>The goal for this section is to modify your project to get the correct
clock configuration. You should also verify that your internal RAM and
flash are running at the expected speed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verification">Verification<a class="hash-link" href="#verification" title="Direct link to heading">​</a></h3><p>Here are the verification points for this section:</p><table><thead><tr><th>Verification Point</th><th>Rationale</th></tr></thead><tbody><tr><td>SystemCoreClock variable&#x27;s value is correct</td><td>The microcontroller is configured to run at the desired frequency.</td></tr><tr><td>Internal RAM is readable</td><td>The microcontroller has the expected amount of internal RAM, it is readable, and the speed is measured</td></tr><tr><td>Internal Flash is readable</td><td>The microcontroller has the expected amount of internal flash, it is readable, and the speed is measured</td></tr><tr><td>Caching is disabled</td><td>Running with caches disabled makes the system less complex and easier to understand.</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h2><p>The following are the prerequisites for this step:</p><ul><li>Information about the clock source on your hardware. It is common to
use a crystal, but other solutions are also possible.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="do">Do<a class="hash-link" href="#do" title="Direct link to heading">​</a></h2><p>We will now go through the steps of adjusting the clock configuration
of our project to get the required MCU frequency. Afterwards we will
discuss how to measure read speed of the internal flash.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="system-clock">System Clock<a class="hash-link" href="#system-clock" title="Direct link to heading">​</a></h3><p>In STM32CubeMX click on the &quot;Clock Configuration&quot; tab. This gives you an
overview of the clock tree for your specific MCU:</p><div class="figure"><a href="/4.21/img/development/board-bring-up/cpu-running/img-01.webp" target="_blank"><img width="600" src="/4.21/img/development/board-bring-up/cpu-running/img-01.webp"></a><p>Clock Configuration</p></div><p>In this example the clock source is selected to be HSI. Many projects
use an external crystal and must use HSE with a suitable divider (/M)
and multiplier (/N). It is out the scope of this guide to advice on
the clock configuration. After you have changed the clock
configuration you must regenerate the project in STM32CubeMX (click
Generate Code in upper right corner).</p><p>The core clock (HCLK) can be calculated at runtime by the generated
code and saved in a variable. This variable can be used by application
code to correctly convert between clock cycles and seconds, and e.g
start timers. To get the variable recalculated you must call the
<em>SystemCoreClockUpdate()</em> function. Insert a call in main.c (in a user
code section):</p><div class="figure"><a href="/4.21/img/development/board-bring-up/cpu-running/img-02.webp" target="_blank"><img width="600" src="/4.21/img/development/board-bring-up/cpu-running/img-02.webp"></a><p>SystemCoreClockUpdate</p></div><p>If we set a breakpoint at the end of that function we can see the core
clock (according to the configuration):</p><div class="figure"><a href="/4.21/img/development/board-bring-up/cpu-running/img-03.webp" target="_blank"><img width="600" src="/4.21/img/development/board-bring-up/cpu-running/img-03.webp"></a><p>SystemCoreClock</p></div><p>Another important point to test is the System Timer. This timer is
running on HCLK divided down to give an interrupt every 1 ms. This
timer is used by the STM32Cube Firmware to implement millisecond delays.</p><p>We can test this by inserting a delay of e.g 5 seconds in main. Verify
this with a stop watch or similar means:</p><div class="figure"><a href="/4.21/img/development/board-bring-up/cpu-running/img-04.webp" target="_blank"><img width="600" src="/4.21/img/development/board-bring-up/cpu-running/img-04.webp"></a><p>Measure delay</p></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flash-and-ram-size-and-speed">Flash and RAM size and speed<a class="hash-link" href="#flash-and-ram-size-and-speed" title="Direct link to heading">​</a></h3><p>It is easy to check the reading speed of memory by using the System
Timer. The System Timer interrupt increments a variable each
millisecond. By reading this variable before and after a piece of
code, we can measure the running time of the code (with 1 ms
resolution). This scheme can be used to measure a time period in many
different places in your application. It is not very precise, but can
be done without external devices like oscilloscopes.</p><p>To do that we first need two volatile variable to save the result. If
we don&#x27;t save the result here, the optimizing compiler will in some
case remove the measuring code:</p><div class="figure"><a href="/4.21/img/development/board-bring-up/cpu-running/img-05.webp" target="_blank"><img width="600" src="/4.21/img/development/board-bring-up/cpu-running/img-05.webp"></a><p>Global volatile variables to hold measurement results</p></div><p>Here is an example where we read the flash from 0x08000000 to 0x08020000 (128 Kb) and time the code:</p><div class="figure"><a href="/4.21/img/development/board-bring-up/cpu-running/img-06.webp" target="_blank"><img width="600" src="/4.21/img/development/board-bring-up/cpu-running/img-06.webp"></a><p>Timing a read loop</p></div><p>You can use code like this to verify the speed of your different
memories. Once you have created a setup in STM32CubeMX you can measure the
read speed and make a note of the result. The measurements can then be
repeated later and verified.  If you want to measure the bandwidth of
your memory (the read speed in kb/s), you can compare the amount of
data with the time measured.</p><p>On a 16 MHz STM32F429 the code runs in 12 ms giving us a read speed of
the internal flash (using this method) of
128kb/0.012s = 10,666 kb/s.</p><p>The same loop above can easily be changed to verify that all the
internal flash is enabled and readable. Just change the start and end
addresses.</p><p>The code can also check the internal RAM. On the F429 the RAM starts
at address 0x20000000. The core coupled memory is at 0x10000000. Check
the datasheet for your specific MCU for the relevant memory addresses.</p><p>You should make a few measurements on your different memories and make
a note of the result. For RAM test both the read and write speed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linker-script">Linker script<a class="hash-link" href="#linker-script" title="Direct link to heading">​</a></h3><p>Another thing to look at is the linker script. This configuration file
tells your linker what are the addresses of the RAM and flashes in
your system. The linker script is generated by CubeMX together with
the project, but it can be good to study it. Later you will in most
cases have to modify it to suit your project&#x27;s needs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cache-on-f7-and-h7">Cache on F7 and H7<a class="hash-link" href="#cache-on-f7-and-h7" title="Direct link to heading">​</a></h3><p>The ARM Cortex-M7 based STM32F7 and STM32H7 microcontrollers include
data and instruction caches. It is recommended to disable at least the
data cache until you have a stable platform. The data cache improves
the performance significantly in many cases, but it also introduces
complexity during testing.</p><p>When you have a stable platform, you can enable the data cache. It is
easier at that point to identify that a given problem originates from
data cache management, since the platform is otherwise functional.</p><p>The complexity of the data cache comes from the fact that the MCU core
reads and writes to the cache, whereas peripherals like DMA2 and LTDC
read directly from memory (and not in the cache). For this reason, you
can be in a situation where you write data to e.g. your framebuffer,
but some of the data is not seen on the display. This is because the
LTDC did not find the new data in the RAM because it is only written
to the cache so far. The solution is to flush the cache at certain
points in your project, but we recommend to deal with this at a later
point.</p><p>Caching can be disabled/enabled in STM32CubeMX in the System Core section.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-internal-dcache-state-machine">TouchGFX internal DCache State Machine<a class="hash-link" href="#touchgfx-internal-dcache-state-machine" title="Direct link to heading">​</a></h4><p>TouchGFX engine keeps track of the current and last rendering operation, there are two states <code>HARDWARE</code> and <code>SOFTWARE</code>. The initial state is set to <code>HARDWARE</code> as the mijority of draw operations are done by hardware. When a state switch occurs the state machine will call the appropriate virtual function to handle cache invalidation. When the state transit from <code>HARDWARE</code> to <code>SOFTWARE</code> it will call the virtual method <code>void touchgfx::HAL::InvalidateCache()</code> and when the state transitions from <code>SOFTWARE</code> to <code>HARDWARE</code> it will call the virtual method <code>void touchgfx::HAL::FlushCache()</code>. The functionality of these two functions is left for the user to implement in the derived HAL class.</p><div class="figure"><a href="/4.21/img/development/board-bring-up/cpu-running/cm7-cache-invalidation-statemachine.svg" target="_blank"><img src="/4.21/img/development/board-bring-up/cpu-running/cm7-cache-invalidation-statemachine.svg"></a><p>TouchGFX engine internal DCache State Machine</p></div><p>If using TouchGFX Generator the implementation of these derived methods will be created in the TouchGFXGeneratedHAL class with function calls to DCache invalidation and no further action is needed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="further-readings">Further Readings<a class="hash-link" href="#further-readings" title="Direct link to heading">​</a></h2><p>The documents linked here contains more information about STM32CubeMX and the STM32 caches:</p><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content"><ul><li>Section on Clock configuration in the <a href="https://www.st.com/content/ccc/resource/technical/document/user_manual/10/c5/1a/43/3a/70/43/7d/DM00104712.pdf/files/DM00104712.pdf/jcr:content/translations/en.DM00104712.pdf" target="_blank" rel="noopener noreferrer">STM32CubeMX User Manual</a></li><li><a href="https://www.st.com/content/ccc/resource/technical/document/application_note/group0/08/dd/25/9c/4d/83/43/12/DM00272913/files/DM00272913.pdf/jcr:content/translations/en.DM00272913.pdf" target="_blank" rel="noopener noreferrer">Level 1 cache on STM32F7 and STM32H7</a></li></ul></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/4.21/docs/development/board-bring-up/how-to/01-create-project"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">1. Create Project</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/4.21/docs/development/board-bring-up/how-to/03-display-internal"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">3. Display with framebuffer in internal RAM</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#goal" class="table-of-contents__link toc-highlight">Goal</a><ul><li><a href="#verification" class="table-of-contents__link toc-highlight">Verification</a></li></ul></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#do" class="table-of-contents__link toc-highlight">Do</a><ul><li><a href="#system-clock" class="table-of-contents__link toc-highlight">System Clock</a></li><li><a href="#flash-and-ram-size-and-speed" class="table-of-contents__link toc-highlight">Flash and RAM size and speed</a></li><li><a href="#linker-script" class="table-of-contents__link toc-highlight">Linker script</a></li><li><a href="#cache-on-f7-and-h7" class="table-of-contents__link toc-highlight">Cache on F7 and H7</a></li></ul></li><li><a href="#further-readings" class="table-of-contents__link toc-highlight">Further Readings</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2023 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">Terms of use</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">Privacy Policy</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie Policy</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">Exercise your rights</a></div></div></div></footer></div></div>
<script src="/4.21/assets/js/runtime~main.35f0f16b.js"></script>
<script src="/4.21/assets/js/main.ac6e3ed7.js"></script>
</body>
</html>